<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Romain CAPLIEZ">

<title>Régression linéaire et tests statistiques</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="02-regressions-lineaires-tests-statistiques_files/libs/clipboard/clipboard.min.js"></script>
<script src="02-regressions-lineaires-tests-statistiques_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="02-regressions-lineaires-tests-statistiques_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="02-regressions-lineaires-tests-statistiques_files/libs/quarto-html/popper.min.js"></script>
<script src="02-regressions-lineaires-tests-statistiques_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02-regressions-lineaires-tests-statistiques_files/libs/quarto-html/anchor.min.js"></script>
<link href="02-regressions-lineaires-tests-statistiques_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02-regressions-lineaires-tests-statistiques_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02-regressions-lineaires-tests-statistiques_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02-regressions-lineaires-tests-statistiques_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02-regressions-lineaires-tests-statistiques_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#théorie" id="toc-théorie" class="nav-link active" data-scroll-target="#théorie">Théorie</a>
  <ul class="collapse">
  <li><a href="#principe-dune-régression-linéaire-simple" id="toc-principe-dune-régression-linéaire-simple" class="nav-link" data-scroll-target="#principe-dune-régression-linéaire-simple">Principe d’une régression linéaire simple</a></li>
  <li><a href="#régression-linéaire-multiple" id="toc-régression-linéaire-multiple" class="nav-link" data-scroll-target="#régression-linéaire-multiple">Régression linéaire multiple</a>
  <ul class="collapse">
  <li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation">Notation</a></li>
  <li><a href="#estimateurs" id="toc-estimateurs" class="nav-link" data-scroll-target="#estimateurs">Estimateurs</a></li>
  <li><a href="#hypothèses" id="toc-hypothèses" class="nav-link" data-scroll-target="#hypothèses">Hypothèses</a></li>
  </ul></li>
  <li><a href="#tests-de-significativité-des-coefficients" id="toc-tests-de-significativité-des-coefficients" class="nav-link" data-scroll-target="#tests-de-significativité-des-coefficients">Tests de significativité des coefficients</a></li>
  <li><a href="#significativité-du-modèle" id="toc-significativité-du-modèle" class="nav-link" data-scroll-target="#significativité-du-modèle">Significativité du modèle</a></li>
  <li><a href="#tests-de-significativité-groupé-des-coefficients" id="toc-tests-de-significativité-groupé-des-coefficients" class="nav-link" data-scroll-target="#tests-de-significativité-groupé-des-coefficients">Tests de significativité groupé des coefficients</a></li>
  <li><a href="#tests-des-hypothèses-et-corrections" id="toc-tests-des-hypothèses-et-corrections" class="nav-link" data-scroll-target="#tests-des-hypothèses-et-corrections">Tests des hypothèses et corrections</a>
  <ul class="collapse">
  <li><a href="#hétéroscédasticité-des-erreurs" id="toc-hétéroscédasticité-des-erreurs" class="nav-link" data-scroll-target="#hétéroscédasticité-des-erreurs">Hétéroscédasticité des erreurs</a></li>
  <li><a href="#normalité-des-erreurs" id="toc-normalité-des-erreurs" class="nav-link" data-scroll-target="#normalité-des-erreurs">Normalité des erreurs</a></li>
  </ul></li>
  <li><a href="#formes-fonctionnelles" id="toc-formes-fonctionnelles" class="nav-link" data-scroll-target="#formes-fonctionnelles">Formes fonctionnelles</a>
  <ul class="collapse">
  <li><a href="#modèles-quadratiques" id="toc-modèles-quadratiques" class="nav-link" data-scroll-target="#modèles-quadratiques">Modèles quadratiques</a></li>
  <li><a href="#modèles-à-élasticités" id="toc-modèles-à-élasticités" class="nav-link" data-scroll-target="#modèles-à-élasticités">Modèles à élasticités</a></li>
  <li><a href="#variables-indicatrices-indépendantes" id="toc-variables-indicatrices-indépendantes" class="nav-link" data-scroll-target="#variables-indicatrices-indépendantes">Variables indicatrices indépendantes</a></li>
  <li><a href="#variables-dinteractions" id="toc-variables-dinteractions" class="nav-link" data-scroll-target="#variables-dinteractions">Variables d’interactions</a></li>
  </ul></li>
  <li><a href="#prédiction" id="toc-prédiction" class="nav-link" data-scroll-target="#prédiction">Prédiction</a></li>
  </ul></li>
  <li><a href="#codes" id="toc-codes" class="nav-link" data-scroll-target="#codes">Codes</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#régression-linéaire-simple" id="toc-régression-linéaire-simple" class="nav-link" data-scroll-target="#régression-linéaire-simple">Régression linéaire simple</a>
  <ul class="collapse">
  <li><a href="#estimation-et-interprétation-des-coefficients" id="toc-estimation-et-interprétation-des-coefficients" class="nav-link" data-scroll-target="#estimation-et-interprétation-des-coefficients">Estimation et interprétation des coefficients</a></li>
  <li><a href="#manipuler-les-résultats" id="toc-manipuler-les-résultats" class="nav-link" data-scroll-target="#manipuler-les-résultats">Manipuler les résultats</a></li>
  <li><a href="#tests-de-student" id="toc-tests-de-student" class="nav-link" data-scroll-target="#tests-de-student">Tests de Student</a></li>
  <li><a href="#tester-la-normalité-des-résidus" id="toc-tester-la-normalité-des-résidus" class="nav-link" data-scroll-target="#tester-la-normalité-des-résidus">Tester la normalité des résidus</a></li>
  <li><a href="#tester-lhomogénéité-de-la-variance" id="toc-tester-lhomogénéité-de-la-variance" class="nav-link" data-scroll-target="#tester-lhomogénéité-de-la-variance">Tester l’homogénéité de la variance</a></li>
  <li><a href="#indépendance-des-variables-explicatives" id="toc-indépendance-des-variables-explicatives" class="nav-link" data-scroll-target="#indépendance-des-variables-explicatives">Indépendance des variables explicatives</a></li>
  </ul></li>
  <li><a href="#régression-robuste-à-lhétéroscédasticité" id="toc-régression-robuste-à-lhétéroscédasticité" class="nav-link" data-scroll-target="#régression-robuste-à-lhétéroscédasticité">Régression robuste à l’hétéroscédasticité</a></li>
  <li><a href="#changement-de-forme-fonctionnelle" id="toc-changement-de-forme-fonctionnelle" class="nav-link" data-scroll-target="#changement-de-forme-fonctionnelle">Changement de forme fonctionnelle</a></li>
  <li><a href="#régression-multiple" id="toc-régression-multiple" class="nav-link" data-scroll-target="#régression-multiple">Régression multiple</a></li>
  <li><a href="#ajout-dun-terme-au-carré" id="toc-ajout-dun-terme-au-carré" class="nav-link" data-scroll-target="#ajout-dun-terme-au-carré">Ajout d’un terme au carré</a></li>
  <li><a href="#test-de-fischer-contraint" id="toc-test-de-fischer-contraint" class="nav-link" data-scroll-target="#test-de-fischer-contraint">Test de Fischer contraint</a></li>
  <li><a href="#ajout-dune-variable-binaire" id="toc-ajout-dune-variable-binaire" class="nav-link" data-scroll-target="#ajout-dune-variable-binaire">Ajout d’une variable binaire</a></li>
  <li><a href="#terme-dinteraction" id="toc-terme-dinteraction" class="nav-link" data-scroll-target="#terme-dinteraction">Terme d’interaction</a></li>
  <li><a href="#ajout-dune-variable-qualitative-à-plusieurs-modalités" id="toc-ajout-dune-variable-qualitative-à-plusieurs-modalités" class="nav-link" data-scroll-target="#ajout-dune-variable-qualitative-à-plusieurs-modalités">Ajout d’une variable qualitative à plusieurs modalités</a></li>
  <li><a href="#multicolinéarité" id="toc-multicolinéarité" class="nav-link" data-scroll-target="#multicolinéarité">Multicolinéarité</a></li>
  <li><a href="#prédiction-1" id="toc-prédiction-1" class="nav-link" data-scroll-target="#prédiction-1">Prédiction</a></li>
  <li><a href="#tables-de-régression" id="toc-tables-de-régression" class="nav-link" data-scroll-target="#tables-de-régression">Tables de régression</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Régression linéaire et tests statistiques</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Romain CAPLIEZ </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="théorie" class="level1">
<h1>Théorie</h1>
<section id="principe-dune-régression-linéaire-simple" class="level2">
<h2 class="anchored" data-anchor-id="principe-dune-régression-linéaire-simple">Principe d’une régression linéaire simple</h2>
<p>Si l’on dispose d’un échantillon de deux variables <span class="math inline">\(X\)</span> et <span class="math inline">\(Y\)</span> pour <span class="math inline">\(N\)</span> individus où chaque individu est noté <span class="math inline">\(i = 1, \cdots, N\)</span>, alors le principe d’une régression linéaire est de trouver la meilleure droite possible pour décrire le couple de variables <span class="math inline">\((Y,X)\)</span>. On cherche ainsi une droite de la forme :</p>
<p><span class="math display">\[
Y_i = \alpha + \beta X_i + u_i
\]</span></p>
<p>Où :</p>
<ul>
<li><p><span class="math inline">\(Y_i\)</span> : représente la variable expliquée/endogène</p></li>
<li><p><span class="math inline">\(X_i\)</span> : représente la variable explicative/exogène</p></li>
<li><p><span class="math inline">\(\alpha\)</span> : représente la constante de la droite : <em>l’ordonnée à l’origine</em></p></li>
<li><p><span class="math inline">\(\beta\)</span> : représente le paramètre de pente de la droite <em>: le coefficient directeur</em></p></li>
<li><p><span class="math inline">\(u_i\)</span> : représente le terme d’erreur : ce qui n’est pas expliqué par le modèle</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le modèle <span class="math inline">\(Y_i = \alpha + \beta X_i + u_i\)</span> correspond au modèle <em>théorique</em> dans la population. On fait l’hypothèse que la variable <span class="math inline">\(Y_i\)</span> est expliquée par la variable <span class="math inline">\(X_i\)</span> de manière linéaire. Le terme <span class="math inline">\(u_i\)</span> représente les erreurs du modèle, c’est à dire tous les éléments que l’on ne capte pas et qui font varier (de manière non systématique) la variable <span class="math inline">\(Y_i\)</span>.</p>
<p>Ce modèle n’est pas estimable puisque l’on ne dispose jamais de données pour l’entièreté de la population : on ne dispose que d’échantillons de cette population. On cherche donc des estimateurs <span class="math inline">\(\hat{\alpha}\)</span> et <span class="math inline">\(\hat{\beta}\)</span> afin de décrire le mieux possible cette relation hypothétique entre <span class="math inline">\(Y_i\)</span> et <span class="math inline">\(X_i\)</span>.</p>
<p>La méthode classique consiste à utiliser la méthode des <strong>Moindres Carrés Ordinaires (MCO / OLS)</strong> qui consiste à trouver les estimateurs <span class="math inline">\(\hat{\alpha}\)</span> et <span class="math inline">\(\hat{\beta}\)</span> qui vont minimiser la distance entre les vraies valeurs <span class="math inline">\(Y_i\)</span> et les valeurs estimées de la droite <span class="math inline">\(\hat{Y}_i\)</span> au carré.</p>
<p>Si on définit les valeurs estimées de la variable endogène et les résidus à partir du modèle de la population comme suit et notés respectivement <span class="math inline">\(\hat{Y}_i\)</span> et <span class="math inline">\(\hat{u}_i\)</span> :</p>
<p><span class="math display">\[
\begin{align}
\hat{Y}_i &amp;= \hat{\alpha} + \hat{\beta} X_i \\
\hat{u}_i &amp;= Y_i - \hat{Y}_i
\end{align}
\]</span></p>
<p>Alors on cherche :</p>
<p><span class="math display">\[
\underset{\hat{\alpha}, \hat{\beta}}Min \sum_{i=1}^N \hat{u}_i^2 \\
\]</span></p>
<p>Ce qui revient à annuler les dérivées suivantes :</p>
<p><span class="math display">\[
\begin{cases}
\frac{\partial \displaystyle \sum_{i=1}^N \hat{u}_i^2}{\partial \hat{\alpha}} = 0 \\    
\frac{\partial \displaystyle \sum_{i=1}^N \hat{u}_i^2}{\partial \hat{\beta}} = 0
\end{cases}
\]</span></p>
<p>Une fois ce système résolu, on trouve :</p>
<p><span class="math display">\[
\begin{align}
\hat{\alpha} &amp;= \overline{Y} - \hat{\beta} \overline{X} \\
\hat{\beta} &amp;= \frac{\text{Cov} \left( X, Y \right)}{\text{V} \left( X \right)}
\end{align}
\]</span></p>
<p>Avec :</p>
<p><span class="math display">\[
\begin{align}
\overline{X} &amp;= \frac{1}{N} \sum_{i=1}^N X_i \\
\overline{Y} &amp;= \frac{1}{N} \sum_{i=1}^N Y_i
\end{align}
\]</span></p>
<p>On interprète les paramètres de la façon suivante :</p>
<ul>
<li><p><span class="math inline">\(\hat{\alpha}\)</span> : Lorsque <span class="math inline">\(X_i=0\)</span>, <span class="math inline">\(Y\)</span> est en moyenne égal à <span class="math inline">\(\hat{\alpha}\)</span>.</p></li>
<li><p><span class="math inline">\(\hat{\beta}\)</span> : Lorsque <span class="math inline">\(X_i\)</span> augmente de 1 unité, alors en moyenne <span class="math inline">\(Y\)</span> augmente de <span class="math inline">\(\hat{\beta}\)</span> unités.</p></li>
</ul>
<p>La variance des résidus est donnée par :</p>
<p><span class="math display">\[
\hat{\sigma}_{u}^2 = \displaystyle \frac{\sum_{i=1}^N \hat{u}_i^2}{N-2}
\]</span></p>
<p>La variance des estimateurs est donnée par :</p>
<p><span class="math display">\[
\begin{align}
\hat{\sigma}^{2}_{\hat{\beta}} &amp;= \frac{\hat{\sigma}_{u}^2}{\sum_{i=1}^N \left( X_i - \overline{X} \right)^2} = \frac{\hat{\sigma}_{u}^2}{N \times V(X)} \\
\hat{\sigma}_{\hat{\alpha}}^2 &amp;= \hat{\sigma}_u^2 \frac{\sum_{i=1}^N X_i^2}{N^2 \times V(X)}
\end{align}
\]</span></p>
</section>
<section id="régression-linéaire-multiple" class="level2">
<h2 class="anchored" data-anchor-id="régression-linéaire-multiple">Régression linéaire multiple</h2>
<section id="notation" class="level3">
<h3 class="anchored" data-anchor-id="notation">Notation</h3>
<p>La régression linéaire multiple reprend le même principe que la régression linéaire simple, mais est définie dans un cadre général où <span class="math inline">\(Y_i\)</span> est expliquée par <span class="math inline">\(K\)</span> variables explicatives <span class="math inline">\(X_{ik}\)</span> avec <span class="math inline">\(k = 1, \cdots, K\)</span>.</p>
<p>Ce modèle peut s’écrire sous forme matricielle :</p>
<p><span class="math display">\[
\mathbf{Y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{u} \]</span></p>
<ul>
<li><p><span class="math inline">\(\mathbf{Y}\)</span> : un vecteur de taille <span class="math inline">\(\left( N \times 1 \right)\)</span> pour la variable endogène/expliquée.</p></li>
<li><p><span class="math inline">\(\mathbf{X}\)</span> : une matrice de taille <span class="math inline">\(\left( N \times K \right)\)</span> qui comprend les variables explicatives/exogènes. En cas d’ajout d’une constante, la taille passe à <span class="math inline">\(\left( N \times K+1 \right)\)</span>.</p>
<ul>
<li><span class="math inline">\(\boldsymbol{\beta}\)</span> : un vecteur de taille <span class="math inline">\(\left( K \times 1 \right)\)</span> qui comprend la valeur du coefficient associé à chaque variable. En cas d’ajout de constante (notée <span class="math inline">\(\alpha\)</span>), la taille passe à <span class="math inline">\((K \times 1 + 1)\)</span>.</li>
</ul></li>
<li><p><span class="math inline">\(\boldsymbol{u}\)</span> : un vecteur de taille <span class="math inline">\(\left( N \times 1 \right)\)</span> qui contient les erreurs du modèle.</p></li>
</ul>
<p>Sous forme développée cela donne :</p>
<p><span class="math display">\[ \begin{bmatrix}     y_1 \\[4pt]    y_2 \\[4pt]    \vdots \\[4pt]    y_N   \end{bmatrix}  =    
\begin{bmatrix} 1 &amp; x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1K} \\[4pt]   1 &amp; x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2K} \\[4pt]    \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\[4pt]   1 &amp;  x_{N1} &amp; x_{N2} &amp; \cdots &amp; x_{NK}   
\end{bmatrix}    
\begin{bmatrix}   \alpha \\ \beta_1 \\[4pt]    \beta_2 \\[4pt]    \vdots \\[4pt]    \beta_K  \end{bmatrix}  +    \begin{bmatrix}    u_1 \\[4pt]    u_2 \\[4pt]    \vdots \\[4pt]    u_N   \end{bmatrix} \]</span></p>
<p>On peut également écrire le modèle sous forme semi-développée en une ligne :</p>
<p><span class="math display">\[ Y_i = \alpha + \beta_1 X_{i1} + \beta_2 X_{i2} + \cdots + \beta_K X_{iK} + u_i \]</span></p>
<p>L’interprétation se fait alors <strong>toute chose égale par ailleurs</strong>. Pour la variable <span class="math inline">\(X_{i1}\)</span>, on dira que lorsque <span class="math inline">\(X_{i1}\)</span> augmente de 1 unité toute chose égale par ailleurs (les autres variables restant constantes), alors en moyenne <span class="math inline">\(Y_i\)</span> augmente de <span class="math inline">\(\beta_1\)</span> unités.</p>
<p>L’idée de la régression linéaire multiple est d’expliquer au mieux la variable <span class="math inline">\(Y_i\)</span> en incorporant l’ensemble des facteurs susceptibles d’affecter <span class="math inline">\(Y_i\)</span>. Inclure une variable dans une régression linéaire multiple permet d’obtenir son effet sur la variable <span class="math inline">\(Y_i\)</span> tout en purgeant l’effet des autres variables.</p>
</section>
<section id="estimateurs" class="level3">
<h3 class="anchored" data-anchor-id="estimateurs">Estimateurs</h3>
<p>Tout comme dans le cas de la régression simple, on cherche à minimiser l’écart au carré entre les vraies valeurs <span class="math inline">\(Y_i\)</span> et les valeurs estimées <span class="math inline">\(\hat{Y}i\)</span> :</p>
<p><span class="math display">\[
\underset{\hat{\beta}} Min \left( \hat{u}'\hat{u} \right)
\]</span></p>
<p>Une fois le système résolu on trouve :</p>
<p><span class="math display">\[
\hat{\beta} = \left( X'X \right)^{-1} X'Y
\]</span></p>
<p>La variance estimée des résidus est donnée par :</p>
<p><span class="math display">\[
\hat{\sigma}^2_u = \frac{\hat{u}'\hat{u}}{N - K - 1}
\]</span></p>
<p>La variance estimée des estimateurs est donnée par :</p>
<p><span class="math display">\[
\hat{\sigma}_{\hat{\beta}}^2 = \hat{\sigma}^2_u \left( X'X \right)^{-1}
\]</span></p>
</section>
<section id="hypothèses" class="level3">
<h3 class="anchored" data-anchor-id="hypothèses">Hypothèses</h3>
<p>Si les hypothèses suivantes sont respectées, alors les estimateurs MCO seront des estimateurs non biaisés et de variance minimale. On dit que ce sont des estimateurs <strong>BLUE : Best Linear Unbiased Estimator</strong>.</p>
<ul>
<li><p>H1 : <span class="math inline">\(E(u) = 0\)</span>. L’espérance de l’erreur est nulle. En moyenne le modèle ne commet pas d’erreur. Il ne sous-estime ni ne surestime la valeur de la variable endogène de manière systématique. Cette hypothèse est nécessaire pour les tests d’hypothèse et prouver l’absence de biais des estimateurs MCO.</p></li>
<li><p>H2 : <span class="math inline">\(X\)</span> est une matrice certaine, c’est à dire non aléatoire, elle est observée sans erreur. On note cette hypothèse : <span class="math inline">\(E \left( u_i | x_i \right) = 0\)</span>. Cela signifie qu’il n’y a aucun lien statistique entre les erreurs et la variable explicative. On n’a oublié aucune variable (qui se retrouverait donc dans les erreurs) qui soit corrélée de quelque manière que ce soit avec une variable explicative. Si cette hypothèse est violée, l’estimateur MCO n’est plus convergent et devient biaisé.</p></li>
<li><p>H3 : <span class="math inline">\(\text{Rang} \left( X \right) = K+1\)</span>. Les variables explicatives sont linéairement indépendantes. Aucune variable ne doit pouvoir être expliquée parfaitement par une combinaison liénaire d’autres variables. Par exemple, on ne peut pas inclure le poids en Kg et le poids en gramme, puisque ces deux variables sont parfaitement liées par une combinaison linéaire : <span class="math inline">\(1 \text{Kg} = 1000 \text{g}\)</span>. Cette hypothèse si elle est violée empêche l’identification du modèle et donc de trouver des estimateurs uniques.</p>
<p>Pour cette troisième hypothèse, il faut également satisfaire la condition suivante : <span class="math inline">\(N&gt;K+1\)</span>. Le nombre d’observations doit être supérieur au nombre de variables explicatives (ici <span class="math inline">\(K+1\)</span> si l’on considère que l’on a une constante, <span class="math inline">\(K\)</span> sinon). Si cette condition n’est pas remplie, le modèle n’est pas estimable.</p></li>
<li><p>H4 : <span class="math inline">\(E \left( uu' \right) = \sigma^2_u I_T\)</span>. Les erreurs ne doivent pas être autocorrélées dans le temps (dans le cas de séries temporelles) ou entre les individus (dans le cas d’une coupe transversale). Les erreurs doivent également avoir une variance constante, et cette variance ne doit pas dépendre des variables explicatives. Si cette hypothèse est violée, les estimateurs MCO ne sont plus de variance minimale.</p>
<p>De manière générale, la matrice de variance-covariance des erreurs s’écrit :</p></li>
</ul>
<p><span class="math display">\[
E \left( u u' \right)=\begin{bmatrix}\operatorname{Var}(u_1) &amp; \operatorname{Cov}(u_1, u_2) &amp; \cdots &amp; \operatorname{Cov}(u_1, u_N) \\[4pt]
\operatorname{Cov}(u_2, u_1) &amp; \operatorname{Var}(u_2) &amp; \cdots &amp; \operatorname{Cov}(u_2, u_N) \\[4pt]
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\[4pt]
\operatorname{Cov}(u_N, u_1) &amp; \operatorname{Cov}(u_N, u_2) &amp; \cdots &amp; \operatorname{Var}(u_N)\end{bmatrix}
\]</span></p>
<p>Dans le cas où les erreurs sont sphériques, la variance des erreurs est constante et égale à <span class="math inline">\(\sigma^2_u\)</span>, tandis que la covariance entre les différents termes d’erreur est nulle. On a donc :</p>
<p><span class="math display">\[
E \left( u u' \right)  =  
\begin{bmatrix}    \sigma^{2}_u &amp; 0 &amp; \cdots &amp; 0 \\    
0 &amp; \sigma^{2}_u &amp; \cdots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\    
0 &amp; 0 &amp; \cdots &amp; \sigma^{2}_u  
\end{bmatrix}  =  
\sigma^{2} _u
\begin{bmatrix}    1 &amp; 0 &amp; \cdots &amp; 0 \\    
0 &amp; 1 &amp; \cdots &amp; 0 \\    
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\    
0 &amp; 0 &amp; \cdots &amp; 1  
\end{bmatrix}  =  \sigma^2_u I_N
\]</span></p>
<ul>
<li>H5 : Cette hypothèse suppose que les résidus sont normalement distribués : <span class="math inline">\(u_i \sim N(0,\sigma_u^2)\)</span>. Cette hypothèse permet de faire des tests de faire de l’inférence statistique.</li>
</ul>
</section>
</section>
<section id="tests-de-significativité-des-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="tests-de-significativité-des-coefficients">Tests de significativité des coefficients</h2>
<p>Comme on ne dispose que d’un échantillon de la population, nous n’avons qu’une estimation de <span class="math inline">\(\beta_k\)</span> notée <span class="math inline">\(\hat{\beta}_k\)</span>. S’il est aisé de voir si <span class="math inline">\(\hat{\beta}_k\)</span> est différent de 0 (ou de n’importe quelle autre constante <span class="math inline">\(a\)</span>) ou non, ce n’est pas le cas de <span class="math inline">\(\beta_k\)</span> le vrai coefficient dans la population. Le test de Student va chercher à savoir si pour un certain niveau de risque, le vrai coefficient de la population est différent de 0 (ou d’une constante <span class="math inline">\(a\)</span>) à partir de l’estimation obtenue et de sa dispersion.</p>
<p>Ce qui nous intéresse généralement est de savoir si la variable <span class="math inline">\(X_{ik}\)</span> a un effet ou non dans la population soit : <span class="math inline">\(\beta_k = 0\)</span>. Mais on peut aussi s’intéresser à des cas différents.</p>
<p>Pour tester cela, on utilise le test de Student avec le jeu d’hypothèse suivant :</p>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : \beta = a  \\       
H_1 : \beta \neq a     
\end{array}
\right.
\]</span></p>
<p>La statistique de Student est définie de la manière suivante :</p>
<p><span class="math display">\[
t_{\hat{\beta}} = \frac{\hat{\beta}-\beta}{\hat{\sigma}_{\hat{\beta}}}
\]</span></p>
<p>Sous l’hypothèse nulle <span class="math inline">\(H_0\)</span>, avec un risque de <span class="math inline">\(\alpha\)</span>% on sait que cette statistique suit une loi de Student à <span class="math inline">\(N-K-1\)</span> degrés de libertés (<span class="math inline">\(N-K\)</span> si pas de constante) : <span class="math inline">\(t_{\hat{\beta}} \sim t_{\alpha/2} \left( N-K-1 \right)\)</span>. Le degré de confiance du test <span class="math inline">\(\alpha\)</span> correspond au risque de première espèce (Faux-positif) c’est à dire au risque de rejeter <span class="math inline">\(H_0\)</span> alors que cette hypothèse est vraie.</p>
<p>La règle de décision est la suivante :</p>
<ul>
<li><p>Si <span class="math inline">\(\left| t_{\hat{\beta}} \right|\)</span> est supérieur à la valeur critique tabulée, alors on rejette <span class="math inline">\(H_0\)</span>. Le coefficient <span class="math inline">\(\beta\)</span> est statistiquement différent de <span class="math inline">\(a\)</span>.</p></li>
<li><p>Si <span class="math inline">\(\left| t_{\hat{\beta}} \right|\)</span> est inférieur à la valeur critique tabulée, alors on ne peut pas rejeter l’hypothèse nulle. Le coefficient <span class="math inline">\(\beta\)</span> n’est pas statistiquement différent de <span class="math inline">\(a\)</span>.</p></li>
</ul>
<p>Il est également possible de faire un test unilatéral sous la forme :</p>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : \beta = a  \\       
H_1 : \beta &lt; a \space{ } \text{ou} \space{} \beta &gt; a    
\end{array}
\right.
\]</span></p>
<p>Dans ce cas la loi suivie par la statistique est : <span class="math inline">\(t_{\hat{\beta}} \sim t_{\alpha} \left( N-K-1 \right)\)</span> .</p>
<p>Il est également possible de calculer le niveau de significativité à partir duquel l’hypothèse nulle ne peut plus être rejetée. C’est ce que l’on appel la <strong>p-value</strong>. Plus cette probabilité est faible, plus le risque de commettre un Faux-positif est faible. On rejettera alors l’hypothèse nulle dès lors que la p.value est inférieure à un seuil donné. Si la p.value est supérieure à ce seuil, on ne pourra pas rejeter l’hypothèse nulle (règle de décision inversée par rapport aux valeurs critiques).</p>
</section>
<section id="significativité-du-modèle" class="level2">
<h2 class="anchored" data-anchor-id="significativité-du-modèle">Significativité du modèle</h2>
<p>On peut décomposer la variance de la variable endogène <span class="math inline">\(Y_i\)</span> comme étant la somme de la variance expliquée par le modèle et de la variance du terme d’erreur :</p>
<p><span class="math display">\[
\begin{align}
\frac{1}{N} \sum_{i=1}^{N} \left( Y_i - \overline{Y} \right)^2 &amp;= \frac{1}{N} \sum_{i=1}^{N} \left( \hat{Y}_i - \overline{Y} \right)^2 + \frac{1}{N} \sum_{i=1}^N u_i^2 \\
\text{ }\\
\text{SCT} &amp;= \text{SCE} + \text{SCR}
\end{align}
\]</span></p>
<p>Cette équation de la variance nous indique que la Somme des Carrés Totaux (SCT) est égale à la Somme des Carrés Expliqués (SCE) plus la Somme des Carrés des Résidus (SCR). Autrement dit, la variation de notre variable endogène se décompose en une partie expliquée par le modèle et une partie que l’on explique pas et qui se retrouve dans les résidus.</p>
<p>Le <span class="math inline">\(R^2\)</span> ou coefficient d’ajustement est une mesure qui permet de déterminer le pourcentage de variance de la variable endogène qui est expliqué par le modèle. Il est donné par :</p>
<p><span class="math display">\[
R^2 = \frac{\text{SCE}}{\text{SCT}} = 1 - \frac{\text{SCR}}{\text{SCT}} \in \left[ 0,1 \right]
\]</span></p>
<p>Ce coefficient est cependant biaisé en cas de régression linéaire multiple. L’ajout d’une variable supplémentaire fait forcément augmenter le <span class="math inline">\(R^2\)</span> le rendant inutile pour la comparaison entre deux modèles ayant un nombre de variables explicatives différent.</p>
<p>Pour cela on utilise le coefficient de détermination ajusté <span class="math inline">\(\overline{R}^2\)</span> :</p>
<p><span class="math display">\[
\overline{R}^2 = 1 - \frac{N-1}{N-K-1} \left( 1 - R^2 \right)
\]</span></p>
<p>Ce coefficient s’interprète de la même manière que le <span class="math inline">\(R^2\)</span> et permet de comparer des modèles avec un nombre de variables explicatives différent. Il est à noter que ces modèles doivent avoir la même variable endogène et le même nombre d’observations.</p>
<p>On peut tester si le modèle dans son ensemble a un pouvoir explicatif en utilisant un test de Fisher défini comme suit :</p>
<p><span class="math display">\[
\left\{    \begin{array}{ll}       H_0 : R^2 = 0  \\       H_1 : R^2 &gt; 0     \end{array}\right.
\]</span></p>
<p>Avec la statistique de test qui sous l’hypothèse nulle suit une loi de Fisher :</p>
<p><span class="math display">\[
F = \frac{R^2/K}{\left( 1 - R^2 \right)/ \left( N-K-1 \right)} \sim \mathcal{F} \left( K, N-K-1 \right)
\]</span></p>
<p>La règle de décision est :</p>
<ul>
<li><p>Si <span class="math inline">\(F &gt;\)</span> valeur critique, alors on rejette <span class="math inline">\(H_0\)</span>. Le modèle est donc globalement statistiquement significatif.</p></li>
<li><p>Si <span class="math inline">\(F &lt;\)</span> valeur critique, alors on ne peut pas rejeter <span class="math inline">\(H_0\)</span>. Le modèle n’est donc pas globalement statistiquement significatif.</p></li>
</ul>
<p>On peut également calculer une p.value :</p>
<ul>
<li><p>Si la p.value est inférieure à un seuil donné, alors on rejette l’hypothèse nulle.</p></li>
<li><p>Si la p.value est supérieure à un seuil donné, alors on ne peut pas rejeter l’hypothèse nulle.</p></li>
</ul>
</section>
<section id="tests-de-significativité-groupé-des-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="tests-de-significativité-groupé-des-coefficients">Tests de significativité groupé des coefficients</h2>
<p>Il est possible de vouloir tester si de manière jointe plusieurs coefficients ont un effet sur la variable endogène. Lorsque différentes variables sont fortement corrélées entre elles (comme les mêmes modalités d’une variable qualitative ou les variables qualitatives avec leurs termes d’interactions), la variance des estimateurs augmente. On aura ainsi tendance à rejeter la significativité individuelle de ces variables. Cependant on peut être intéressé par le fait de savoir si cet ensemble de variables, pas forcément significatives de manière individuelle, a un impact sur la variable expliquée une fois considérées toutes ensembles.</p>
<p>Pour cela on va utiliser le test de Fisher sur un sous-groupe de variables.</p>
<p>Supposons que l’on estime le modèle suivant :</p>
<p><span class="math display">\[
Y_i = \alpha + \beta_1 X_{1i} + \beta_2 X_{2i} + \beta_3 X_{3i} + u_i
\]</span></p>
<p>Supposons que les variables <span class="math inline">\(X_2\)</span> et <span class="math inline">\(X_3\)</span> ne soient pas significatives prises individuellement et que ces variables présentent un fort degré de corrélation entre elles. On peut vouloir tester si, prises ensemble, ces variables ont un pouvoir explicatif sur <span class="math inline">\(Y_i\)</span> ou si elles sont “inutiles”.</p>
<p>On cherche donc à tester si :</p>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : \beta_2 = \beta_3 = 0  \\       
H_1 : \beta_2 \neq 0 \text{ } | \text{ } \beta_3 \neq 0     
\end{array}
\right.
\]</span></p>
<p>Pour cela on va estimer en plus du premier modèle (que l’on appelle le modèle non-contraint) un second modèle que l’on nomme <strong>modèle contraint</strong> et qui va intégrer les contraintes imposées dans l’hypothèse nulle. On estime donc le modèle suivant :</p>
<p><span class="math display">\[
Y_i = \alpha + \beta_1 X_{1i} + e_i
\]</span></p>
<p>Sur chacun des modèles, on va calculer la somme des carrés des résidus : <span class="math inline">\(\text{SCR}_{\text{NC}} = \sum_{i=1}^N \hat{u}_i^2\)</span> et <span class="math inline">\(\text{SCR}_{\text{C}} = \sum_{i=1}^N \hat{e}_i^2\)</span>.</p>
<p>On calcule ensuite la statistique de test qui sous l’hypothèse nulle suit la loi :</p>
<p><span class="math display">\[
F = \frac{(\text{SCR}_{\text{C}} - \text{SCR}_{\text{NC}}) / q }{\text{SCR}_{\text{NC}} / (T-K-1)} \sim \mathcal{F}(q, T-K-1)
\]</span></p>
<p>Avec <span class="math inline">\(q\)</span> le nombre de contraintes imposées (ici 2).</p>
<p>La règle de décision est :</p>
<ul>
<li><p>Si <span class="math inline">\(F &gt;\)</span> valeur critique, alors on rejette l’hypothèse nulle de non significativité jointe. Les variables prises ensembles ont un pouvoir explicatif.</p></li>
<li><p>Si <span class="math inline">\(F &lt;\)</span> valeur critique, alors on ne peut pas rejeter l’hypothèse nulle de non significativité jointe. Les variables prises ensembles n’ont pas de pouvoir explicatif significatif.</p></li>
</ul>
<p>Tous comme pour les autres tests, on peut utiliser la p.value comme règle de décision.</p>
<p>Ce test est généralisable avec davantage de contraintes et avec des formes de contraintes différentes.</p>
</section>
<section id="tests-des-hypothèses-et-corrections" class="level2">
<h2 class="anchored" data-anchor-id="tests-des-hypothèses-et-corrections">Tests des hypothèses et corrections</h2>
<section id="hétéroscédasticité-des-erreurs" class="level3">
<h3 class="anchored" data-anchor-id="hétéroscédasticité-des-erreurs">Hétéroscédasticité des erreurs</h3>
<p>L’hypothèse d’homoscédasticité des erreurs signifie que la variance des erreurs est constante au cours du temps / des individus et constante avec les observations des variables explicatives. Lorsque cette hypothèse est violée, on parle d’erreurs hétéroscédastiques. Dans un tel cas, la variance des estimateurs MCO n’est plus minimale.</p>
<p>Parmi les sources les plus courantes d’hétéroscédasticité, on peut citer :</p>
<ul>
<li><p>l’hétérogénéité de l’échantillon</p></li>
<li><p>l’oubli d’une variable explicative</p></li>
<li><p>l’asymétrie dans la distribution de certaines variables explicatives</p></li>
<li><p>une mauvaise forme fonctionnelle</p></li>
<li><p>la nature des données (ex : moyennes d’observations issues d’échantillons de tailles différentes)</p></li>
</ul>
<p>Pour tester la présence d’hétéroscédasticité, différents tests sont disponibles comme :</p>
<ul>
<li><p>le test de Breusch-Pagan (1979)</p></li>
<li><p>le test de White (1980)</p></li>
<li><p>le test ARCH</p></li>
</ul>
<section id="test-de-breusch-pagan-1979" class="level4">
<h4 class="anchored" data-anchor-id="test-de-breusch-pagan-1979">Test de Breusch-Pagan (1979)</h4>
<p>Supposons le modèle de régression multiple :</p>
<p><span class="math display">\[
Y_i = \alpha + \beta_1 X_{1i} + \beta_2 X_{2i} + \cdots + \beta_k X_{ki} + u_i
\]</span></p>
<p>On suppose que le terme d’erreur suit une loi normale de variance :</p>
<p><span class="math display">\[
\sigma^2_{u_i} = f(a_0 + a_1 Z_{1i} + \cdots + a_p Z_{pi})
\]</span></p>
<p>Où <span class="math inline">\(f\)</span> est une fonction quelconque, les coefficients <span class="math inline">\(a_j\)</span> ne sont pas liés aux coefficients du modèle de régression et <span class="math inline">\(Z_{1i}, \cdots, Z{pi}\)</span> sont des variables susceptibles d’être à la source de l’hétéroscédasticité. Certaines de ces variables, voir toutes, peuvent être des variables explicatives du modèle de régression.</p>
<p>Tester l’hypothèse nulle d’homoscédasticité revient à tester : <span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : a_1 = a_2 = \cdots = a_p = 0  \\       
H_1 : \exists \hspace{0.2cm} a_j \neq 0 \hspace{0.2cm} j = 1, \cdots, p     
\end{array}
\right.
\]</span></p>
<p>En effet, sous l’hypothèse nulle la variance des erreurs est constante :</p>
<p><span class="math display">\[
\sigma^2_{u_i} = f(a_0)
\]</span></p>
<p>Pour réaliser ce test, on suit les étapes suivantes :</p>
<ul>
<li><p>Estimer la régression <span class="math inline">\(Y_i = \alpha + \beta_1 X_{1i} + \beta_2 X_{2i} + \cdots + \beta_k X_{ki} + u_i\)</span> par les MCO et en déduire la série des résidus <span class="math inline">\(\hat{u}_i\)</span>.</p></li>
<li><p>On calcule l’estimateur du maximum de vraisemblance de la variance du terme d’erreur : <span class="math inline">\(\hat{\sigma}^2_{MV} = \frac{1}{N}\sum_{i=1}^N \hat{u}_i\)</span></p></li>
<li><p>On calcule la quantité pour <span class="math inline">\(i = 1, \cdots, N\)</span> :</p></li>
</ul>
<p><span class="math display">\[
h_i = \frac{\hat{u}_i^2}{\hat{\sigma}^2_{MV}}
\]</span></p>
<ul>
<li>Après avoir spécifié les variables <span class="math inline">\(Z_{1i}, \cdots, Z_{pi}\)</span>, on régresse <span class="math inline">\(h_i\)</span> sur ces variables</li>
</ul>
<p><span class="math display">\[
h_i = a_0 + a_1 Z_{1i} + \cdots + a_p X_{pi} + e_i
\]</span></p>
<ul>
<li><p>On calcule la somme des carrés expliqués (SCE) de cette régression auxiliaire</p></li>
<li><p>On calcule la statistique de test <span class="math inline">\(BP\)</span> qui sous <span class="math inline">\(H_0\)</span> suit une loi du Khi-deux à <span class="math inline">\(p\)</span> degrés de liberté :</p></li>
</ul>
<p><span class="math display">\[
BP  = \frac{1}{2} SCE \sim \chi^2_p
\]</span></p>
<p>La règle de décision est la suivante :</p>
<ul>
<li><p>Si <span class="math inline">\(BP &gt; \chi_p^2\)</span> (ou p.value inférieure à un seuil donné) : on rejette l’hypothèse nulle d’homoscédasticité. Les erreurs sont hétéroscédastiques, la variance des estimateurs MCO n’est donc pas minimale.</p></li>
<li><p>Si <span class="math inline">\(BP &lt; \chi^2_p\)</span> (ou p.value supérieure à un seuil donné) : on ne peut pas rejeter l’hypothèse nulle d’homoscédasticité. Les erreurs sont homoscédastiques.</p></li>
</ul>
<p>Le test de Breusch-Pagan est un test général qui couvre un grand nombre de cas d’hétéroscédasticité. Il s’agit d’un test asymptotique qui n’est valable que pour des échantillons de taille suffisamment importante.</p>
</section>
<section id="test-de-white-1980" class="level4">
<h4 class="anchored" data-anchor-id="test-de-white-1980">Test de White (1980)</h4>
<p>Le test de White est un test très général qui ne repose pas sur l’hypothèse de normalité du terme d’erreur. La procédure de test est la suivante :</p>
<ul>
<li>On estime le modèle de régression multiple :</li>
</ul>
<p><span class="math display">\[
Y_i = \alpha + \beta_1 X_{1i} + \beta_2 X_{2i} + \cdots + \beta_k X_{ki} + u_i
\]</span></p>
<ul>
<li><p>On en déduit la série des résidus <span class="math inline">\(\hat{u}_i\)</span></p></li>
<li><p>On estime la régression auxiliaire suivante :</p></li>
</ul>
<p><span class="math display">\[
\hat{u}_i^2 = a_0 + a_1 X_{1i} + b_1 X_{1i}^2 + a_2 X_{2i} + b_2 X_{2i}^2 + \cdots + a_k X_{ki} + b_k X_{ki}^2 + e_t
\]</span></p>
<p>Cette régression traduit l’existence possible d’une relation entre le carré des résidus de la régression (autrement dit la variance comme la moyenne des résidus est égale à 0) et les variables explicatives (au carré). Il est également possible d’introduire des termes croisés/d’interaction.</p>
<ul>
<li><p>On calcule le coefficient de détermination <span class="math inline">\(R^2\)</span> de la régression auxiliaire</p></li>
<li><p>On teste :</p></li>
</ul>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : a_1 = b_1 = a_2 = b_2 = \cdots = a_k = b_k = 0  \\       
H_1 : \exists \hspace{0.2cm} c_j \neq 0 \hspace{0.3cm} j = 1, \cdots, k \hspace{0.3cm} c \in \{a,b\}     
\end{array}
\right.
\]</span></p>
<p>La statistique de test suit sous l’hypothèse nulle une loi du Khi-deux dont le nombre de degrés de liberté correspond au nombre de paramètres estimés hors constante dans la régression auxiliaire. Elle est donnée par :</p>
<p><span class="math display">\[
N \times R^2 \sim \chi^2_{2k}
\]</span></p>
<p>La règle de décision est la suivante :</p>
<ul>
<li>Si <span class="math inline">\(NR^2 &gt; \chi^2_{2k}\)</span> (ou p.value inférieure à un seuil donné) : on rejette l’hypothèse nulle d’homoscédasticité. Les erreurs sont hétéroscédastiques, la variance des estimateurs MCO n’est donc pas minimale.</li>
<li>Si <span class="math inline">\(NR^2 &lt; \chi^2_{2k}\)</span> (ou p.value supérieure à un seuil donné) : on ne peut pas rejeter l’hypothèse nulle d’homoscédasticité. Les erreurs sont homoscédastiques.</li>
</ul>
</section>
<section id="test-arch" class="level4">
<h4 class="anchored" data-anchor-id="test-arch">Test ARCH</h4>
<p>Dans certaines séries temporelles (particulièrement les séries financières), la variance des erreurs (aussi appelée volatilité) peut dépendre de ses valeurs passées. Il s’agit d’un cas d’hétéroscédasticité conditionnelle. Le test ARCH permet de détecter ce type d’hétéroscédasticité. La procédure de test est la suivante :</p>
<ul>
<li>On estime le modèle de régression multiple :</li>
</ul>
<p><span class="math display">\[
Y_t = \alpha + \beta_1 X_{1t} + \beta_2 X_{2t} + \cdots + \beta_k X_{kt} + u_t
\]</span></p>
<p>Où <span class="math inline">\(t\)</span> indique une période temporelle.</p>
<ul>
<li><p>On déduit la série des résidus <span class="math inline">\(\hat{u}_t\)</span></p></li>
<li><p>On calcule la série des résidus au carrés <span class="math inline">\(\hat{u}_t^2\)</span></p></li>
<li><p>On régresse la série des résidus au carré sur ses <span class="math inline">\(l\)</span> valeurs passées et une constante :</p></li>
</ul>
<p><span class="math display">\[
\hat{u}_t^2 = a_0 + \sum_{i=1}^l a_i \hat{u}_{t-i}^2 + e_t
\]</span></p>
<ul>
<li><p>On calcule le <span class="math inline">\(R^2\)</span> de cette régression auxiliaire</p></li>
<li><p>On teste :</p></li>
</ul>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : a_1 = a_2 = \cdots = a_l = 0  \\       
H_1 : \exists \hspace{0.2cm} a_j \neq 0 \hspace{0.3cm} j = 1, \cdots, l   
\end{array}
\right.
\]</span></p>
<p>La statistique de test est donnée par :</p>
<p><span class="math display">\[
T \times R^2 \sim \chi^2_l
\]</span></p>
<p>La règle de décision est la suivante :</p>
<ul>
<li>Si <span class="math inline">\(TR^2 &gt; \chi^2_{l}\)</span> (ou p.value inférieure à un seuil donné) : on rejette l’hypothèse nulle d’homoscédasticité. Les erreurs sont conditionnellement hétéroscédastiques, la variance des estimateurs MCO n’est donc pas minimale.</li>
<li>Si <span class="math inline">\(TR^2 &lt; \chi^2_{l}\)</span> (ou p.value supérieure à un seuil donné) : on ne peut pas rejeter l’hypothèse nulle d’homoscédasticité. Les erreurs sont homoscédastiques.</li>
</ul>
</section>
<section id="estimation" class="level4">
<h4 class="anchored" data-anchor-id="estimation">Estimation</h4>
<p>Si la forme de l’hétéroscédasticité est connue, il est possible d’utiliser des méthodes telles que les <strong>Moindres Carrés Pondérés</strong> pour la prendre en compte. Généralement en pratique, on ne connaît pas la forme de l’hétéroscédasticité.</p>
<p>Dans ce cas, il est possible d’utiliser l’estimateur de la matrice de variance-covariance de White ou encore celui de Newey et West. Il s’agit de corrections apportées à la matrice de variance-covariance pour tenir compte de l’hétéroscédasticité. Les coefficients du modèle de régression ne changent pas. Seuls les écarts-types estimés changent.</p>
</section>
</section>
<section id="normalité-des-erreurs" class="level3">
<h3 class="anchored" data-anchor-id="normalité-des-erreurs">Normalité des erreurs</h3>
<p>L’hypothèse de normalité des erreurs est nécessaire afin de procéder à une analyse d’inférence statistique des coefficients estimés. Cette hypothèse permet de dériver la loi suivie par les estimateurs et donc par les statistiques de test. Pour tester la normalité des erreurs on peut utiliser le test de Jarque et Bera (1980).</p>
<section id="test-de-jarque-et-berra-1980" class="level4">
<h4 class="anchored" data-anchor-id="test-de-jarque-et-berra-1980">Test de Jarque et Berra (1980)</h4>
<p>Ce test se base sur la définition des coefficients de skewness <span class="math inline">\(S\)</span> (asymétrie de la distribution) et de kurtosis <span class="math inline">\(K\)</span> (épaisseur des queues de distribution) :</p>
<p><span class="math display">\[
\begin{align}
S &amp;= \frac{\left[ \frac{1}{N}\sum_{i=1}^N \left( X_i - \overline{X} \right)^3 \right]^2}{\left[ \frac{1}{N} \sum_{i=1}^N \left( X_i - \overline{X} \right)^2 \right]^3} \\
K &amp;= \frac{\frac{1}{N} \sum_{i=1}^N \left( X_i - \overline{X} \right)^4}{\left[ \frac{1}{N} \sum_{i=1}^N \left( X_i - \overline{X} \right)^2 \right]^{3}}
\end{align}
\]</span></p>
<p>Une loi normale dispose d’un coefficient d’asymétrie (skewness) nul et d’un coefficient d’aplatissement (kurtosis) égal à 3.</p>
<p>La procédure de test est la suivante :</p>
<ul>
<li>Estimer la régression :</li>
</ul>
<p><span class="math display">\[
Y_i = \alpha + \beta_1 X_{1i} + \beta_2 X_{2i} + \cdots + \beta_k X_{ki} + u_i
\]</span></p>
<ul>
<li><p>Récupérer les résidus <span class="math inline">\(\hat{u}_i\)</span></p></li>
<li><p>Tester :</p></li>
</ul>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : S = 0 \text{ et } K = 3 \\       
H_1 : S \neq 0 \text{ ou } K \neq 3
\end{array}
\right.
\]</span></p>
<p>La statistique de test <span class="math inline">\(JB\)</span> est donnée par :</p>
<p><span class="math display">\[
JB = \frac{N}{6} \left[ S^2 + \frac{1}{4} (K-3)^2 \right] \sim \chi^2_2
\]</span></p>
<p>La règle de décision est :</p>
<ul>
<li><p>Si <span class="math inline">\(JB &gt; \chi^2_2\)</span> (ou p.value inférieure à un seuil donné) alors on rejette l’hypothèse nulle de normalité des résidus. Les résidus ne suivent pas une loi normale.</p></li>
<li><p>Si <span class="math inline">\(JB &lt; \chi^2_2\)</span> (ou p.value supérieure à un seuil donné), alors on ne peut pas rejeter l’hypothèse nulle de normalité des résidus. Il semble que les résidus suivent une loi normale.</p></li>
</ul>
</section>
<section id="estimation-1" class="level4">
<h4 class="anchored" data-anchor-id="estimation-1">Estimation</h4>
<p>Asymptotiquement les estimateurs MCO disposent de bonnes propriétés. Asymptotiquement (donc pour des échantillons assez grands), les estimateurs MCO sont efficaces. De plus, l’ensemble des méthodes basiques d’inférence visant à la mise en oeuvre des tests statistiques et à la construction d’intervalles de confiance sont approximativement valides sans recourir à l’hypothèse de normalité des erreurs.</p>
</section>
</section>
</section>
<section id="formes-fonctionnelles" class="level2">
<h2 class="anchored" data-anchor-id="formes-fonctionnelles">Formes fonctionnelles</h2>
<section id="modèles-quadratiques" class="level3">
<h3 class="anchored" data-anchor-id="modèles-quadratiques">Modèles quadratiques</h3>
<p>On rappelle que l’aspect “linéaire” de la régression linéaire implique la linéarité dans les <em>paramètres</em>. Il n’existe aucune restriction sur la forme que doit prendre <span class="math inline">\(Y\)</span> ou <span class="math inline">\(X\)</span>.</p>
<p>Ainsi le modèle suivant ne peut être conceptualisé sous la forme d’un modèle de régression linéaire :</p>
<p><span class="math display">\[
Y_i = \frac{1}{\alpha + \beta X_i} + u_i
\]</span></p>
<p>En revanche on peut très bien imaginer un modèle de la forme</p>
<p><span class="math display">\[
Y_i = \alpha + \beta_1 X_i + \beta_2 X_i^2 + u_i
\]</span></p>
<p>Une telle forme fonctionnelle permet de prendre en compte de manière simple des non-linéarités. Cela permet de capter des effets marginaux croissants ou décroissants et non plus constants. Cela permet d’avoir une relation en cloche telle que <span class="math inline">\(X_i\)</span> va faire augmenter <span class="math inline">\(Y_i\)</span> jusqu’à un certain point, puis va le faire diminuer.</p>
<p>Dans un tel modèle, on ne peut plus estimer l’impact global qu’une augmentation de <span class="math inline">\(X_i\)</span> entraîne sur <span class="math inline">\(Y_i\)</span>. Il faut regarder la variation de <span class="math inline">\(Y_i\)</span> pour une valeur donnée de <span class="math inline">\(X_i\)</span>.</p>
<p>Pour cela on peut utiliser l’approximation :</p>
<p><span class="math display">\[
\frac{\Delta \hat{Y_i}}{\Delta X_i} \approx \hat{\beta}_1 + 2 \hat{\beta}_2X_i
\]</span></p>
<p>La pente de la relation entre <span class="math inline">\(X_i\)</span> et <span class="math inline">\(Y_i\)</span> dépend de la valeur de <span class="math inline">\(X_i\)</span>. Généralement, on insère des valeurs d’intérêts dans cette approximation telles que la moyenne, médiane… afin d’obtenir une rapide description de la relation.</p>
<p>Pour trouver le point de retournement de la relation on utilise :</p>
<p><span class="math display">\[
X^* = \frac{-\hat{\beta}_1}{2 \hat{\beta}_2}
\]</span></p>
<p>La forme de la relation quadratique dépend du signe des deux coefficients.</p>
</section>
<section id="modèles-à-élasticités" class="level3">
<h3 class="anchored" data-anchor-id="modèles-à-élasticités">Modèles à élasticités</h3>
<p>Il est possible de transformer certaines variables en logarithme afin d’obtenir des interprétation en terme d’élasticités (changement en pourcentage) plutôt que des changements en unités. Par exemple, il est souvent plus intéressant d’avoir une interprétation en pourcentage lorsque l’on parle d’augmentation de salaire plutôt que d’augmentation en dollars.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Nom</th>
<th>Modèle</th>
<th>Interprétation de <span class="math inline">\(\beta\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Niveau-Niveau</td>
<td><span class="math inline">\(Y_i = \alpha + \beta X_i +u_i\)</span></td>
<td><span class="math inline">\(\Delta Y_i = \beta_1 \Delta X_i\)</span></td>
</tr>
<tr class="even">
<td>Niveau-log</td>
<td><span class="math inline">\(Y_i = \alpha + \beta \times log( X_i) +u_i\)</span></td>
<td><span class="math inline">\(\Delta Y_i = (\frac{\beta}{100}) \text{%} \Delta X_i\)</span></td>
</tr>
<tr class="odd">
<td>Log-Niveau</td>
<td><span class="math inline">\(log(Y_i) = \alpha + \beta X_i +u_i\)</span></td>
<td><span class="math inline">\(\text{%} \Delta Y_i = (100 \beta) \Delta X_i\)</span></td>
</tr>
<tr class="even">
<td>Log-Log</td>
<td><span class="math inline">\(log(Y_i) = \alpha + \beta \times log( X_i) +u_i\)</span></td>
<td><span class="math inline">\(\text{%} \Delta Y_i = \beta \text{ } \text{%}\Delta X_i\)</span></td>
</tr>
</tbody>
</table>
<ul>
<li><p>Dans un modèle en <code>Niveau-Log</code>, augmenter <span class="math inline">\(X_i\)</span> de 1% fait augmenter <span class="math inline">\(Y_i\)</span> de <span class="math inline">\(\frac{\beta}{100}\)</span> unités en moyenne.</p></li>
<li><p>Dans un modèle <code>Log-Niveau</code>, augmenter <span class="math inline">\(X_i\)</span> de 1 unité, fait augmenter <span class="math inline">\(Y_i\)</span> de <span class="math inline">\((100 \times \beta) \text{%}\)</span>.</p></li>
<li><p>Dans un modèle <code>Log-Log</code>, augmenter <span class="math inline">\(X_i\)</span> de 1%, fait augmenter <span class="math inline">\(Y_i\)</span> de <span class="math inline">\(\beta \text{%}\)</span> .</p></li>
</ul>
<p>L’augmentation n’est plus linéaire.</p>
</section>
<section id="variables-indicatrices-indépendantes" class="level3">
<h3 class="anchored" data-anchor-id="variables-indicatrices-indépendantes">Variables indicatrices indépendantes</h3>
<p>Il est possible d’inclure dans un modèle des variables dites binaires ou “dummy” afin de décrire une information qualitative à deux modalités telle que le sexe d’une personne.</p>
<p>Un tel modèle est noté :</p>
<p><span class="math display">\[
Y_i = \alpha + \beta X_i + \delta \times \mathbf{1}_i + u_1
\]</span></p>
<p>Avec <span class="math inline">\(\mathbf{1}_i = 1\)</span> si l’individu possède la caractéristique voulue (homme) et <span class="math inline">\(\mathbf{1}_i = 0\)</span> sinon (femme).</p>
<p>Dans un tel modèle, le paramètre <span class="math inline">\(\delta\)</span> correspond à la différence moyenne de <span class="math inline">\(Y_i\)</span> entre les personnes ayant la caractéristique et celles qui ne l’ont pas pour un même niveau de <span class="math inline">\(X_i\)</span>. Il s’agit d’une différence systématique entre les deux groupes. On décale la constante entre les deux groupes. La relation pour la variable <span class="math inline">\(X_i\)</span> reste la même pour les deux groupes, mais il existe une différence systématique entre eux pour tous les niveaux de <span class="math inline">\(X_i\)</span>.</p>
<p>La constante pour le groupe de référence (donné par le groupe pour lequel <span class="math inline">\(\mathbf{1}_i = 0\)</span>) est <span class="math inline">\(\alpha\)</span> tandis que la constante pour le groupe étudié (donné par le groupe pour lequel <span class="math inline">\(\mathbf{1}_i = 1\)</span>) est donnée par <span class="math inline">\(\alpha + \delta\)</span>.</p>
<p>Ce modèle avec constante est équivalent à</p>
<p><span class="math display">\[
Y_i =  \beta X_i + \delta_1 \times \mathbf{1}_{1i} + \delta_2 \times \mathbf{1}_{2i} + u_1
\]</span></p>
<p>où :</p>
<ul>
<li><p><span class="math inline">\(\mathbf{1}_{1i} = 1\)</span> pour le groupe étudié (homme) et 0 sinon (femme)</p></li>
<li><p><span class="math inline">\(\mathbf{1}_{2i} = 1\)</span> pour le groupe de référence (femme) et 0 sinon.</p></li>
</ul>
<p>Si le modèle inclut les deux variables indicatrices ainsi que la constante, il n’est plus identifiable puisque ces trois variables sont parfaitement colinéaires entre elles : elles s’expliquent parfaitement par une combinaison linéaire : <span class="math inline">\(\alpha = \mathbf{1}_{1i} + \mathbf{1}_{2i}\)</span>.</p>
<p>Si la qualité que l’on souhaite étudier a de multiples modalités (catégorie socio-professionnelle) , alors on intègre une variable par modalité (-1 s’il y a une constante). L’interprétation des coefficients se fera toujours par rapport à la variable de référence.</p>
<p>Pour tester si une variable qualitative à <span class="math inline">\(j\)</span> modalités est intéressante à inclure, on peut effectuer un test de Fisher avec l’hypothèse nulle : <span class="math inline">\(\delta_1 = \delta_2 = \cdots = \delta_{j-1} = 0\)</span>.</p>
</section>
<section id="variables-dinteractions" class="level3">
<h3 class="anchored" data-anchor-id="variables-dinteractions">Variables d’interactions</h3>
<p>L’ajout de variables qualitatives permet d’introduire une différence systématique entre deux groupes d’individus. Mais la relation de pente reste la même entre les deux groupes. Il est possible de relâcher cette hypothèse d’homogénéité des pentes en intégrant des variables d’interactions telles que :</p>
<p><span class="math display">\[
Y_i = \alpha + \delta_1 \mathbf{1}_i + \beta X_i + \delta_2 X_i \mathbf{1}_i + u_i
\]</span></p>
<p>Dans ce cas, il existe une différence systématique entre les personnes du groupe étudié et les personnes du groupe de référence : <span class="math inline">\(\delta_1\)</span>. Mais la relation est également différente entre les deux groupes. Pour le groupe de référence la relation est donnée par <span class="math inline">\(\beta\)</span> tandis que pour le groupe étudié la relation de pente est donnée par <span class="math inline">\(\beta + \delta_2\)</span>.</p>
<p>La constante ainsi que la pente de la droite diffèrent selon les groupes.</p>
<p>Pour tester si <span class="math inline">\(Y_i\)</span> suit le même modèle pour les différents groupes étudiés, on va effectuer un test de Fisher dans lequel l’hypothèse nulle sera : <span class="math inline">\(\delta_1 = \delta_2 = 0\)</span>.</p>
</section>
</section>
<section id="prédiction" class="level2">
<h2 class="anchored" data-anchor-id="prédiction">Prédiction</h2>
<p>Un modèle de régression linéaire peut-être utilisé afin de prédire la variable endogène pour des valeurs définies des variables exogènes.</p>
<p>Ainsi pour un modèle :</p>
<p><span class="math display">\[
Y_i = \alpha + \beta_1 X_{i1} + \beta_2 X_{i2} + \cdots + \beta_k X_{ik} + u_i
\]</span></p>
<p>On souhaite trouver la valeur moyenne de <span class="math inline">\(Y_i\)</span> étant donné que les régresseurs prennent des valeurs spécifiques <span class="math inline">\(c_1, c_2, \cdots, c_k\)</span> :</p>
<p><span class="math display">\[
\theta_0 = E(Y_i | X_{i1} = c_1, X_{i2} = c_2, \cdots, X_{ik} = c_k) = \alpha + \beta_1 c_1 + \beta_2 c_2 + \cdots + \beta_k c_k
\]</span></p>
<p>Le point estimé est donc :</p>
<p><span class="math display">\[
\hat{\theta}_0 = \hat{\alpha} + \hat{\beta}_1 c_1 + \hat{\beta}_2 c_2 + \cdots + \hat{\beta}_k c_k
\]</span></p>
</section>
</section>
<section id="codes" class="level1">
<h1>Codes</h1>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Charger les librairies et tous les objets de setup. Comme rien n’est chargé pour l’instant il faut :</p>
<ul>
<li><p>Utiliser la syntaxe <code>here::here()</code> pour dire que l’on utilise la fonction <code>here()</code> du package <code>here</code></p></li>
<li><p>Indiquer le chemin en entier jusqu’au script <code>setup.R</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exécute le script setup.R pour charger tous les éléments importants</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"02-codes"</span>, <span class="st">"utils"</span>, <span class="st">"setup.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="régression-linéaire-simple" class="level2">
<h2 class="anchored" data-anchor-id="régression-linéaire-simple">Régression linéaire simple</h2>
<section id="estimation-et-interprétation-des-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="estimation-et-interprétation-des-coefficients">Estimation et interprétation des coefficients</h3>
<p>On cherche à expliquer le salaire d’un individu. On suppose que le salaire horaire moyen d’un individu dépend de son niveau d’éducation de la façon suivante :</p>
<p><span class="math display">\[
\text{wage}_i = \alpha + \beta \times \text{educ}_i + u_i
\]</span></p>
<p>Ce modèle suppose une relation dans la population linéaire entre l’éducation d’un individu et son salaire. Le terme <span class="math inline">\(u_i\)</span> comprend tous les facteurs pouvant affecter le salaire d’un individu et n’étant pas compris dans cette relation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Représenter graphiquement les données sous forme d'un nuage de points</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>wage1 <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> educ, <span class="at">y =</span> wage)) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Il semble graphiquement y avoir une relation croissante entre l’éducation et le salaire horaire moyen d’un individu.</p>
<p>On va estimer cette relation à partir d’une régression linéaire avec la fonction <code>lm()</code>. Cette fonction prend au minimum deux arguments : une formule indiquant la relation à estimer, et le jeu de données.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation de la régression linéaire</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>reg1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ, <span class="at">data =</span> wage1)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Montrer les résultats</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>reg1_summary <span class="ot">&lt;-</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(reg1) <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = wage ~ educ, data = wage1)

Residuals:
    Min      1Q  Median      3Q     Max 
-5.3396 -2.1501 -0.9674  1.1921 16.6085 

Coefficients:
            Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept) -0.90485    0.68497  -1.321               0.187    
educ         0.54136    0.05325  10.167 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.378 on 524 degrees of freedom
Multiple R-squared:  0.1648,    Adjusted R-squared:  0.1632 
F-statistic: 103.4 on 1 and 524 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>La ligne<code>(Intercept)</code> correspond à la constante, tandis que les lignes suivantes correspondent aux variables explicatives du modèle. La colonne <code>estimate</code> donne la valeur des estimateurs <span class="math inline">\(\hat\beta\)</span>. La colonne <code>Std. Error</code> donne la valeur des écarts-types des estimateurs <span class="math inline">\(\hat{\sigma}_{\hat{\beta}}\)</span>. La colonne <code>t value</code> indique la statistique du test de Student <span class="math inline">\(t_\hat{\beta}\)</span>. La colonne <code>Pr(|t|)</code> donne la p.value du test de Student.</p>
<p>La valeur de <span class="math inline">\(\hat{\alpha}\)</span> nous indique que dans l’échantillon lorsqu’un individu a un niveau d’éducation nul, alors son revenu horaire moyen estimé est de <span class="math inline">\(-0.90485\)</span> dollars environ ce qui n’est pas réaliste, un salaire ne pouvait pas être négatif. On remarque que la p.value du test de Student est de <span class="math inline">\(0.187 &gt; 0.05\)</span>. On ne peut donc rejeter l’hypothèse selon laquelle la constante serait différente de 0.</p>
<p>La valeur de <span class="math inline">\(\hat{\beta}\)</span> nous indique que dans l’échantillon, lorsqu’un individu augmente son nombre d’années d’éducation de 1, alors en moyenne, son salaire horaire moyen augmente de <span class="math inline">\(0.54136\)</span> dollars. La p.value du test de Student est extrêmement faible et largement inférieure à 5%. Ces estimation nous laissent penser que l’éducation a bien un effet positif sur le salaire dans la population.</p>
<p>Nous pouvons voir que <span class="math inline">\(R^2 = 0.1648\)</span> ce qui signifie que ce modèle permet d’expliquer <span class="math inline">\(16.48 \text{%}\)</span> de la variance du salaire horaire moyen dans notre échantillon.</p>
<p>La toute dernière ligne <code>F-statistic</code> donne la statistique de test et la p.value du test de Fisher de significativité du modèle. On remarque que cette statistique de test est extrêmement faible et largement inférieure à 5%. On rejette donc l’hypothèse nulle de non significativité du modèle. Notre modèle a un certain pouvoir explicatif sur notre variable.</p>
<p>La fonction <code>lm()</code> retourne une liste contenant différents objets. Pour connaître la teneur de ces objets, il faut se référer à la documentation en ligne ou bien en exécutant <code>?lm</code> dans la console afin de faire apparaître la documentation associée à la fonction. Il arrive (de manière trop fréquente) que la documentation laisse à désirer. Dans ce cas, il est possible de regarder les différents objets contenus dans notre modèle de régression grâce à la fonction <code>names()</code> qui retourne le nom des objets. Si les noms sont explicites cela peut être d’une grande aide. Si les noms ne sont pas explicites, on peut regarder dans le code source de la fonction en exécutant <code>lm</code> (sans parenthèse) dans la console. Il faut alors se débrouiller pour comprendre le code. Parfois cela est inévitable.</p>
</section>
<section id="manipuler-les-résultats" class="level3">
<h3 class="anchored" data-anchor-id="manipuler-les-résultats">Manipuler les résultats</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Déterminer les différents objets renvoyés par le modèle de régression</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(reg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "coefficients"  "residuals"     "effects"       "rank"         
 [5] "fitted.values" "assign"        "qr"            "df.residual"  
 [9] "xlevels"       "call"          "terms"         "model"        </code></pre>
</div>
</div>
<p>On peut voir que notre objet <code>reg1</code> contenant notre régression linéaire comprend 12 objets aux noms assez explicites que l’on va pouvoir appeler pour différents usages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les coefficients estimés</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>reg1<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        educ 
 -0.9048516   0.5413593 </code></pre>
</div>
</div>
<p>L’objet <code>reg1_summary</code> dispose lui aussi d’un certain nombre d’objets pouvant être utiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(reg1_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "call"          "terms"         "residuals"     "coefficients" 
 [5] "aliased"       "sigma"         "df"            "r.squared"    
 [9] "adj.r.squared" "fstatistic"    "cov.unscaled" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les coefficients estimés</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>reg1_summary<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Std. Error   t value                       Pr(&gt;|t|)
(Intercept) -0.9048516 0.68496782 -1.321013 0.1870735007624442503004758009
educ         0.5413593 0.05324804 10.166746 0.0000000000000000000002782599</code></pre>
</div>
</div>
<p>Ici ce sont les coefficients ainsi que les écarts-types, t-stat et p.values qui sont retournées dans un objet de classe <code>matrix</code>. Lorsque l’on effectue des manipulations, des tests ou des procédures en tour genre nécessitant d’utiliser les estimations, il est possible de simplement afficher les coefficients puis de les noter à la main. Cette méthode est déconseillée puisqu’elle implique d’avoir à modifier manuellement au moindre changement, sans compter que cela devient très vite un calvaire si le nombre d’estimations et de coefficients grandit.</p>
<p>Etant un objet <code>matrix</code>, les règles de manipulation classiques sont faisables :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire les p.values des coefficients : toutes les lignes, 4ème colonne</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>reg1_summary<span class="sc">$</span>coefficients[,<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   (Intercept)                           educ 
0.1870735007624442503004758009 0.0000000000000000000002782599 </code></pre>
</div>
</div>
<p>Par exemple, on peut chercher à définir automatiquement si les coefficients sont statistiquement significatif au seuil de 5% ou non.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Case_when() permet de tester des conditions sur des objets multiples et de manière imbriquée</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">case_when</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Si les p.valuues sont inférieures à 0.05 alors le coefficient est significatif</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  reg1_summary<span class="sc">$</span>coefficients[,<span class="dv">4</span>] <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"significatif"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sinon le coefficient n'est pas significatif</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="st">"Non significatif"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pour plus de clarté rajoute les noms des coefficients</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">rownames</span>(reg1_summary<span class="sc">$</span>coefficients))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept)               educ 
"Non significatif"     "significatif" </code></pre>
</div>
</div>
<p>Une méthode simple de manipulation consiste à transformer l’output en un <code>tibble</code> afin de pouvoir le manipuler avec les techniques classiques de manipulation de dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_reg1_coef <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  reg1_summary<span class="sc">$</span>coefficients <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean_names permet de nettoyer les noms des variables afin qu'ils soient conforme avec une syntaxe standard</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ajouter les noms des coefficients</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">coef =</span> <span class="fu">rownames</span>(reg1_summary<span class="sc">$</span>coefficients),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Arrondir à 3 chiffres après la virgule pour gagner en lisibilité</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(estimate, std_error, t_value, pr_t),</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">.fns =</span> \(variable) <span class="fu">round</span>(variable, <span class="dv">3</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Déterminer si le coefficient est significatif ou non</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">signif =</span> </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        pr_t <span class="sc">&lt;=</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"significatif"</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">.default =</span> <span class="st">"non-significatif"</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Placer le nom des coef en première position</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(coef) <span class="sc">|&gt;</span> </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  coef        estimate std_error t_value  pr_t signif          
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           
1 (Intercept)   -0.905     0.685   -1.32 0.187 non-significatif
2 educ           0.541     0.053   10.2  0     significatif    </code></pre>
</div>
</div>
</section>
<section id="tests-de-student" class="level3">
<h3 class="anchored" data-anchor-id="tests-de-student">Tests de Student</h3>
<p>La p.value reportée dans le tablau de régression correspond à un test de Student bilatéral dans le quel hypothèse nulle testée est <span class="math inline">\(\beta = 0\)</span>. On peut tester d’autres hypothèses de manière un peu plus manuelle.</p>
<p>On veut dans un premier temps tester si le coefficient d’éducation est statistiquement supérieur à 0. Il s’agit donc d’un test unilatéral :</p>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : \beta = 0  \\       
H_1 : \beta &gt; 0    
\end{array}
\right.
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire la valeur du coefficient de l'éducation </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>educ_coef_reg1 <span class="ot">&lt;-</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  df_reg1_coef <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"educ"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire l'erreur standard du coefficient de l'éduction</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>educ_ste_reg1 <span class="ot">&lt;-</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  df_reg1_coef <span class="sc">|&gt;</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"educ"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(std_error)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir le risque à 5%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Récupérer les degrés de liberté de la régression : N-K-1</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>freedom_degree <span class="ot">&lt;-</span> reg1_summary<span class="sc">$</span>df[<span class="dv">2</span>]</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la statistique de test</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>t_stat <span class="ot">&lt;-</span> educ_coef_reg1 <span class="sc">/</span> educ_ste_reg1</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenir les valeurs critiques avec un niveau de confiance de 1-alpha (en unilatéral on ne divise pas alpha par deux)</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>crit_val <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="dv">1</span> <span class="sc">-</span> alpha, freedom_degree)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la p_value (en unilatéral il s'agit de la p_value bilatérale divisée par 2)</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(t_stat), freedom_degree))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Déterminer si le coefficient est significatif ou pas</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">if_else</span>(p_value <span class="sc">&lt;=</span> alpha, <span class="st">"significatif"</span>, <span class="st">"non-significatif"</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher une phrase de résultats</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"le résultat du test de student unilatéral est : {result} avec une p.value de {p_value} pour un risque de {alpha * 100}%"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>le résultat du test de student unilatéral est : significatif avec une p.value de 0.0000000000000000000000980228196202429 pour un risque de 5%</code></pre>
</div>
</div>
<p>On va maintenant chercher à déterminer si le coefficient de l’éducation est significativement différent de 0.5 ou pas :</p>
<p><span class="math display">\[
\left\{    
\begin{array}{ll}       
H_0 : \beta = 0.5  \\       
H_1 : \beta \neq 0.5   
\end{array}
\right.
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire la valeur du coefficient de l'éducation </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>educ_coef_reg1 <span class="ot">&lt;-</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  df_reg1_coef <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"educ"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(estimate)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraire l'erreur standard du coefficient de l'éduction</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>educ_ste_reg1 <span class="ot">&lt;-</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  df_reg1_coef <span class="sc">|&gt;</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(coef <span class="sc">==</span> <span class="st">"educ"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(std_error)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir le risque à 5% et 1%</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.01</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Récupérer les degrés de liberté de la régression : N-K-1</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>freedom_degree <span class="ot">&lt;-</span> reg1_summary<span class="sc">$</span>df[<span class="dv">2</span>]</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir la valeur de beta que l'on veut tester : ici 0.5</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la statistique de test</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>t_stat <span class="ot">&lt;-</span> (educ_coef_reg1 <span class="sc">-</span> mu) <span class="sc">/</span> educ_ste_reg1</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtenir les valeurs critiques avec un niveau de confiance de 1-alpha/2</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>crit_val <span class="ot">&lt;-</span> <span class="fu">qt</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>, freedom_degree)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer la p_value </span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>p_value <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(<span class="sc">-</span><span class="fu">abs</span>(t_stat), freedom_degree)</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"La valeur critique à {alpha*100}% est {crit_val}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La valeur critique à 5% est 1.96450151697793
La valeur critique à 1% est 2.58524428855796</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"La statistique de test est {abs(t_stat)}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La statistique de test est 0.773584905660378</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"La p.value du test est {round(p_value, 3)}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La p.value du test est 0.44</code></pre>
</div>
</div>
<p>On ne peut pas dire que le coefficient de l’éducation soit significativement différent de 0.5. Si dans votre projet il est fréquent que vous ayez à effectuer des tests de Student avec d’autres types d’hypothèse, créez votre propre fonction afin de ne pas avoir à répéter ce type de code en permanence.</p>
</section>
<section id="tester-la-normalité-des-résidus" class="level3">
<h3 class="anchored" data-anchor-id="tester-la-normalité-des-résidus">Tester la normalité des résidus</h3>
<p>Avant de tester statistiquement la normalité des résidus, il peut être intéressant de regarder graphiquement s’ils semblent suivre ou non une loi normale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_normality</span>(reg1) <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ce graphique est un <code>QQ-plot</code>. Il compare la distribution des quantiles d’une loi normale (ligne verte) avec la distribution des quantiles des résidus (points bleus). Si les résidus suivent une loi normale, alors la distribution des quantiles des résidus doit se superposer à la ligne verte. Ici on remarque que les quantiles des résidus ne suivent absolument pas ceux d’une loi normale.</p>
<p>On peut Représenter le même type de graphique de manière plus manuelle :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">residuals =</span> reg1<span class="sc">$</span>residuals) <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> residuals)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Q-Q Plot des résidus"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Quantiles de la distribution normale associée"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Quantiles empiriques"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Les points doivent suivre la ligne rouge"</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On peut également représenter la distribution des résidus et la comparer avec celle d’une loi normale ayant la même variance et la moyenne moyenne.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Représenter la distrution empirique des résidus ainsi que la distribution de la loi normale qu'ils devraient suivre</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">residuals =</span> reg1<span class="sc">$</span>residuals) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> residuals)) <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Résidus"</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Loi normale empirique"</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun =</span> dnorm, </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(reg1<span class="sc">$</span>residuals), <span class="at">sd =</span> <span class="fu">sd</span>(reg1<span class="sc">$</span>residuals)),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Résidus"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Loi normale empirique"</span> <span class="ot">=</span> <span class="st">"red"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Résidus"</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Densité"</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Comparaison de la distribution des résidus avec la distribution normale"</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Il semble, au vu des graphiques précédents, que nos résidus ne suivent pas une loi normale. Ils semblent être caractérisés par une asymétrie à droite ainsi que des queues de distribution plus épaisses impliquant des valeurs extrêmes plus fréquentes. On rappelle que la loi normale est caractérisée par un coefficient de skewness égal à 0 et un coefficient de kurtosis égal à 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>moments<span class="sc">::</span><span class="fu">skewness</span>(reg1<span class="sc">$</span>residuals) <span class="co"># Coefficient de skewness des résidus</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.860679</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>moments<span class="sc">::</span><span class="fu">kurtosis</span>(reg1<span class="sc">$</span>residuals) <span class="co"># Coefficient de kurtosis des résid</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.797006</code></pre>
</div>
</div>
<p>On remarque que les résidus sont caractérisés par une skewness positive et une kurtosis plus élevée que celle de la loi normale ce qui semble nous indiquer que nos résidus ne suivent pas une loi normale. On peut tester individuellement si la skewness est statistiquement différente de 0 et si la kurtosis est statistiquement différente de 3 avec les tests d’Agostino et d’Anscombe :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester si les résidus ont de la skewness</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>moments<span class="sc">::</span><span class="fu">agostino.test</span>(reg1<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    D'Agostino skewness test

data:  reg1$residuals
skew = 1.8607, z = 12.2099, p-value &lt; 0.00000000000000022
alternative hypothesis: data have a skewness</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester si les résidus ont de la kurtosis en excès</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>moments<span class="sc">::</span><span class="fu">anscombe.test</span>(reg1<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anscombe-Glynn kurtosis test

data:  reg1$residuals
kurt = 7.797, z = 7.967, p-value = 0.000000000000001626
alternative hypothesis: kurtosis is not equal to 3</code></pre>
</div>
</div>
<p>Statistiquement il semble que pour un seuil inférieur à 1%, les résidus soient caractérisés par une skewness positive et un excès de kurtosis par rapport à la loi normale, ce qui confirme un peu plus que les résidus ne semblent pas suivre une loi normale.</p>
<p>On peut également tester si conjointement les coefficients de skewness et de kurtosis sont égaux à 0 et 3 respectivement avec le test de Jarque et Bera</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>moments<span class="sc">::</span><span class="fu">jarque.test</span>(reg1<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Jarque-Bera Normality Test

data:  reg1$residuals
JB = 807.84, p-value &lt; 0.00000000000000022
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>Le test nous indique que les résidus ne semblent pas avoir des coefficients de skewness et de kurtosis égaux à ceux de la loi normale pour un niveau de risque très faible. On peut en conclure que nos résidus ne suivent pas une loi normale.</p>
<p>On peut également tester l’hypothèse nulle que les données proviennent d’une population normalement échantillonnée avec le test de Shapiro-Wilk. On peut utiliser la fonction <code>check_normality()</code> du package <code>performance</code> pour faire cela, mais cela ne renvoit qu’un message et on ne peut pas extraire le résultat du test ce qui peut être handicapant dans certains cas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_normality</span>(reg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Non-normality of residuals detected (p &lt; .001).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(reg1<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  reg1$residuals
W = 0.84606, p-value &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Encore une fois, ce test rejette la normalité des résidus pour un niveau de risque très faible. On peut conclure que nos résidus ne suivent pas une loi normale.</p>
<p>Cela n’est cependant pas un gros problème pour notre estimation puisque asymptotiquement nos estimateurs disposent de bonnes propriétés et que les tests statistiques usuels restent valides asymptotiquement. Or nous avons 526 observations ce qui est suffisant généralement pour utiliser les propriétés asymptotiques.</p>
<p>Attention car la non-normalité des résidus signifie quand même que tous les éléments générateurs des données n’ont pas été pris en compte ce qui peut être dérangeant notamment pour faire de la prévision puisque l’on sous-estime l’apparition de valeurs extrêmes.</p>
</section>
<section id="tester-lhomogénéité-de-la-variance" class="level3">
<h3 class="anchored" data-anchor-id="tester-lhomogénéité-de-la-variance">Tester l’homogénéité de la variance</h3>
<p>Comme pour la normalité, on va commencer par une analyse graphique. Pour cela on va représenter les valeurs prédites du modèle en fonction des résidus au carré et observer la relation entre les deux.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">residuals_2 =</span> reg1<span class="sc">$</span>residuals<span class="sc">**</span><span class="dv">2</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitted_values =</span> reg1<span class="sc">$</span>fitted.values</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fitted_values, <span class="at">y =</span> residuals_2)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Il semblerait que la variance des résidus ne soit pas constante pour les différents niveaux de valeurs prédites ce qui est une suspicion de présence d’hétéroscédasticité parmi nos résidus.</p>
<p>La librairie <code>performance</code> permet également de réaliser ce genre de graphiques.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_heteroscedasticity</span>(reg1) <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Pour tester la présence d’hétéroscédasticité, on peut utiliser le test de Breusch-Pagan (utilisé par la fonction <code>check_heteroscedasticity</code> mais qui encore une fois ne permet pas d’extraire les résultats) et le test de White qui tests tous les deux l’hypothèse nulle d’homoscédasticité des résidus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Breusch-Pagan test</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_heteroscedasticity</span>(reg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Heteroscedasticity (non-constant error variance) detected (p &lt; .001).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Breusch-Pagan test</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">bptest</span>(reg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  reg1
BP = 15.306, df = 1, p-value = 0.00009144</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># White test</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>whitestrap<span class="sc">::</span><span class="fu">white_test</span>(reg1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>White's test results

Null hypothesis: Homoskedasticity of the residuals
Alternative hypothesis: Heteroskedasticity of the residuals
Test Statistic: 23.24
P-value: 0.000009</code></pre>
</div>
</div>
<p>Les tests de Breusch-Pagan et de White indiquent avec un risque faible que les résidus ne sont pas homoscédastiques. Ils sont caractérisés par une variance non constante Nos estimateurs ne sont donc plus de variance minimale ce qui réduit notre capacité à inférer l’information.</p>
</section>
<section id="indépendance-des-variables-explicatives" class="level3">
<h3 class="anchored" data-anchor-id="indépendance-des-variables-explicatives">Indépendance des variables explicatives</h3>
<p>Afin que les estimateurs soient sans biais il est nécessaire qu’il n’existe aucun lien statistique entre les résidus et ces variables (si une variable est corrélée avec les résidus alors seul le coefficient de cette variable sera biaisé). Cela signifie qu’il faut s’assurer que notre modèle inclue toutes les variables pouvant expliquer <span class="math inline">\(Y_i\)</span> et étant corrélées avec <span class="math inline">\(X_{ki}\)</span>. Si une telle variable a été omise alors le coefficient de la variable explicative sera biaisée puisque l’on ne peut pas savoir si l’évolution observée de la variable <span class="math inline">\(X_{ki}\)</span> est dû à sa propre évolution ou à celle de la variable omise.</p>
<p>On peut utiliser certaines techniques pour tester si nos variables sont exogènes (test de Hausman avec les variables instrumentales) mais il s’agit surtout d’une histoire d’argumentation sur le choix des variables inclues dans le modèle ou non.</p>
<p>Dans notre cas on peut légitimement penser que notre coefficient associé à <em>educ</em> n’est pas exogène. En effet, la durée de scolarisation peut être liée au sexe de la personne qui lui même peut influer sur le salaire. La durée d’éducation peut aussi être liée au talent de l’individu qui peut lui-même influer sur le salaire…</p>
</section>
</section>
<section id="régression-robuste-à-lhétéroscédasticité" class="level2">
<h2 class="anchored" data-anchor-id="régression-robuste-à-lhétéroscédasticité">Régression robuste à l’hétéroscédasticité</h2>
<p>Nous venons de montrer que nos résidus ne sont pas caractérisés par une variance constante rendant ainsi la variance des estimateurs MCO non-minimale.</p>
<p>La méthode la plus pratique consiste à corriger les écarts-types de l’hétéroscédasticité et à utiliser ce que l’on appelle des “erreurs standards robustes”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">hccm</span>(reg1) <span class="co"># version raffinée de White</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            (Intercept)         educ
(Intercept)   0.5378539 -0.044577403
educ         -0.0445774  0.003826987</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">hccm</span>(reg1, <span class="at">type =</span> <span class="st">"hc0"</span>) <span class="co"># version standard de White</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            (Intercept)         educ
(Intercept)  0.52431924 -0.043490427
educ        -0.04349043  0.003738473</code></pre>
</div>
</div>
<p>On peut obtenir une table de régression avec la fonction <code>coeftest()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(reg1) <span class="co"># table standard non-corrigée</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

             Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept) -0.904852   0.684968  -1.321              0.1871    
educ         0.541359   0.053248  10.167 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(reg1, <span class="at">vcov=</span>hccm) <span class="co"># Version corrigée avec la correction raffinée de White</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

             Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept) -0.904852   0.733385 -1.2338              0.2178    
educ         0.541359   0.061863  8.7510 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">coeftest</span>(reg1, <span class="at">vcov=</span><span class="fu">hccm</span>(reg1, <span class="at">type =</span> <span class="st">"hc0"</span>)) <span class="co"># Version corrigée avec la version standard de White</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

             Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept) -0.904852   0.724099 -1.2496               0.212    
educ         0.541359   0.061143  8.8540 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>On peut voir que les résultats sur les écarts-types et p.values ne changent pas énormément ce qui semble indiquer que l’hétéroscédasticité n’est pas un trop grand problème. Notre coefficient de l’éducation est toujours significativement différent de 0 avec un risque très faible.</p>
</section>
<section id="changement-de-forme-fonctionnelle" class="level2">
<h2 class="anchored" data-anchor-id="changement-de-forme-fonctionnelle">Changement de forme fonctionnelle</h2>
<p>La première régression nous indiquait que le salaire moyen horaire d’un individu augmentait de <span class="math inline">\(0.541\)</span> dollars en moyenne lorsque son niveau d’étude augmentait de 1. On peut se demander s’il ne serait pas plus pertinent de réfléchir l’augmentation du salaire en pourcentage plutôt qu’en unité monétaire. D’une part cela rend probablement la compréhension plus facile et d’autre part cela permet d’avoir un effet non-linéaire de l’augmentation monétaire, mais un effet constant en pourcentage.</p>
<p>Le modèle devient donc :</p>
<p><span class="math display">\[
log(\text{wage}_i) = \alpha + \beta \times \text{educ}_i + u_i
\]</span></p>
<p>Pour intégrer une telle non-linéarité, on peut modifier notre jeu de données et intégrer une nouvelle variable <code>log_wage = log(wage)</code>. Ou alors on peut intégrer <code>log(wage)</code> directement dans notre formule.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>reg2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> educ, <span class="at">data =</span> wage1)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>reg2_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg2)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>(lmtest<span class="sc">::</span><span class="fu">coeftest</span>(reg2, <span class="at">vcov =</span> hccm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

             Estimate Std. Error t value              Pr(&gt;|t|)    
(Intercept) 0.5837727  0.0994161   5.872        0.000000007651 ***
educ        0.0827444  0.0078291  10.569 &lt; 0.00000000000000022 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Dans un tel cas, nous sommes dans un modèle Log-Niveau. L’interprétation de <span class="math inline">\(\beta \approx 0.083\)</span> est la suivante : une année d’étude supplémentaire augmente en moyenne le salaire horaire de l’individu de <span class="math inline">\(8.3 \text{%}\)</span>. Ce coefficient est significativement différent de 0 même en prenant en compte une possible hétéroscédasticité.</p>
<p>Ici passer <code>educ</code> sous forme logarithme n’aurait aucun intérêt. Augmenter son nombre d’années d’études de 1% ne fait aucun sens. On raisonne en termes d’années supplémentaires.</p>
</section>
<section id="régression-multiple" class="level2">
<h2 class="anchored" data-anchor-id="régression-multiple">Régression multiple</h2>
<p>Comme nous avons pu le mentionner, il est fort probable que</p>
<ol type="1">
<li><p>Le coefficient de l’éducation soit biaisé à cause de variables omises.</p></li>
<li><p>D’autres variables soient intéressantes dans une analyse s’intéressant aux déterminants du salaire.</p></li>
</ol>
<p>Il pourrait être pertinent de se dire que le salaire dépend certes de son niveau d’éducation, mais aussi de son expérience professionnelle <code>exper</code> et de son nombre d’années avec son employeur actuel <code>tenure</code>.</p>
<p>Le modèle devient donc :</p>
<p><span class="math display">\[
log(wage_i) = \alpha + \beta_1 \text{educ}_i + \beta_2 \text{exper}_i + \beta_3 \text{tenure}_i + u_i
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>reg3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage1)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>(reg3_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(wage) ~ educ + exper + tenure, data = wage1)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.05802 -0.29645 -0.03265  0.28788  1.42809 

Coefficients:
            Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept) 0.284360   0.104190   2.729              0.00656 ** 
educ        0.092029   0.007330  12.555 &lt; 0.0000000000000002 ***
exper       0.004121   0.001723   2.391              0.01714 *  
tenure      0.022067   0.003094   7.133     0.00000000000329 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4409 on 522 degrees of freedom
Multiple R-squared:  0.316, Adjusted R-squared:  0.3121 
F-statistic: 80.39 on 3 and 522 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Ces résultats nous indiquent que lorsque le nombre d’années d’études d’un individu augmente toutes choses égales par ailleurs (à expérience et tenure constante), alors le salaire moyen horaire augmente de 9.2% environ. Chaque année d’étude augmente en moyenne de 9.2% le salaire horaire d’un individu. Ce coefficient est significativement différent de 0 à un seuil inférieur à 1%.</p>
<p>Une année d’expérience professionnelle supplémentaire augmente en moyenne le salaire horaire de 0.41% toute chose égale par ailleurs. Ce coefficient est significativement différent de 0 à un seuil de 5% mais pas de 1%.</p>
<p>Une année supplémentaire avec le même employeur augmente en moyenne le salaire horaire de 2.2% tous les autres facteurs maintenus constants. Ce coefficient est significativement différent de 0 à un seuil de 1%.</p>
<p>Ce modèle permet d’expliquer 31.6% de la variance de la variable endogène. Ce modèle a statistiquement un pouvoir explicatif à un seuil de 1%.</p>
</section>
<section id="ajout-dun-terme-au-carré" class="level2">
<h2 class="anchored" data-anchor-id="ajout-dun-terme-au-carré">Ajout d’un terme au carré</h2>
<p>Théoriquement il est possible de penser qu’une année supplémentaire d’expérience fasse augmenter le salaire mais que passer un certain moment dans la carrière d’un individu cela ne soit plus vrai. On peut tester cela en ajoutant un terme au carré dans la régression qui devient :</p>
<p><span class="math display">\[
log(wage_i) = \alpha + \beta_1 \text{educ}_i + \beta_2 \text{exper}_i + \beta_3 \text{exper}_i^2 + \beta_4 \text{tenure}_i + u_i
\]</span></p>
<p>Comme pour les logarithme, on peut modifier notre jeu de données et inclure une variable <code>exper_2 = exper ** 2</code>. Mais on peut aussi l’inclure directement dans la formule de régression grâce à la fonction <code>I()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>reg4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">**</span><span class="dv">2</span>) <span class="sc">+</span> tenure, <span class="at">data =</span> wage1)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>(reg4_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(wage) ~ educ + exper + I(exper^2) + tenure, 
    data = wage1)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.97087 -0.26809 -0.03463  0.27663  1.28678 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)  0.1983445  0.1019556   1.945               0.0523 .  
educ         0.0853489  0.0071885  11.873 &lt; 0.0000000000000002 ***
exper        0.0328542  0.0051135   6.425      0.0000000002979 ***
I(exper^2)  -0.0006606  0.0001111  -5.945      0.0000000050775 ***
tenure       0.0208413  0.0030037   6.938      0.0000000000118 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.427 on 521 degrees of freedom
Multiple R-squared:  0.3595,    Adjusted R-squared:  0.3545 
F-statistic: 73.09 on 4 and 521 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Dans un tel modèle, l’interprétation des coefficients <code>educ</code> et <code>tenure</code> ne change pas. Par contre il n’est plus possible d’interpréter <code>exper</code> de la même manière puisqu’il y a désormais deux termes à prendre en compte. Il est possible de calculer les effets marginaux de manière manuelle. La fonction <code>effect()</code> du package <code>effect</code> permet de faire cela automatiquement. Basiquement, elle prend comme argument le nom de la variable dont on veut mesurer l’effet et le modèle de régression associé.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Affciher l'effet non linéaire de la variable expérience</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>effects<span class="sc">::</span><span class="fu">effect</span>(<span class="st">"exper"</span>, reg4) <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>() <span class="sc">|&gt;</span> </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 exper effect
exper
       1       10       30       40       50 
1.409140 1.639426 1.768013 1.634120 1.368102 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="02-regressions-lineaires-tests-statistiques_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On peut voir que l’expérience a tout d’abord un effet positif sur le salaire puis un effet négatif en fin de carrière toutes choses égales par ailleurs. Attention la valeur sur l’axe des ordonnées ne peut pas être interpréter comme une valeur de coefficient. Par exemple, pour 10 années d’expérience <span class="math inline">\(log(\text{wage}) = 1.639\)</span> mais cela NE SIGNIFIE PAS qu’avoir 10 ans d’expérience fait augmenter le salaire de 163.9%. Pour avoir l’information de l’augmentation du salaire pour une année d’étude supplémentaire on utilise la formule :</p>
<p><span class="math display">\[
\Delta \widehat{log(\text{wage})} \approx (\beta_2 + 2 \beta_3 \text{exper}) \times \Delta \text{exper}
\]</span></p>
<p>On peut calculer le point de retournement avec la formule :</p>
<p><span class="math display">\[
x^* = \frac{-\hat{\beta}_3}{2 \hat{\beta}_3}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>coef_exper_reg4 <span class="ot">&lt;-</span> reg4<span class="sc">$</span>coefficients[<span class="dv">3</span>]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>coef_exper_2_reg4 <span class="ot">&lt;-</span> reg4<span class="sc">$</span>coefficients[<span class="dv">4</span>]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>retournement <span class="ot">&lt;-</span> <span class="sc">-</span>coef_exper_reg4 <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>coef_exper_2_reg4)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"Après {round(retournement)} années d'expérience, une année d'expérience supplémentaire fait diminuer le salaire"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Après 25 années d'expérience, une année d'expérience supplémentaire fait diminuer le salaire</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>exper_i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>change <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>effet_1 <span class="ot">&lt;-</span> (coef_exper_reg4 <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> coef_exper_2_reg4 <span class="sc">*</span> exper_i) <span class="sc">*</span> change</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"Une personne avec {exper_i} ans d'expérience verra son salaire varier de {round(effet_1,4)*100}% en augmentant son nombre d'années d'expérience de {change}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Une personne avec 1 ans d'expérience verra son salaire varier de 3.15% en augmentant son nombre d'années d'expérience de 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>exper_i <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>change <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>effet_2 <span class="ot">&lt;-</span> (coef_exper_reg4 <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> coef_exper_2_reg4 <span class="sc">*</span> exper_i) <span class="sc">*</span> change</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">glue</span>(<span class="st">"Une personne avec {exper_i} ans d'expérience verra son salaire varier de {round(effet_2, 4)*100}% en augmentant son nombre d'années d'expérience de {change}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Une personne avec 30 ans d'expérience verra son salaire varier de -0.68% en augmentant son nombre d'années d'expérience de 1</code></pre>
</div>
</div>
<p>Attention, la formule pour calculer le changement prédit n’est qu’une approximation. Elle convient bien pour des petits changements mais pas pour des grands. Dans ce cas on calcule la valeur prédite de <span class="math inline">\(Y_i\)</span> pour deux valeurs différentes de <span class="math inline">\(X_i\)</span> et on fait la différence entre les deux.</p>
</section>
<section id="test-de-fischer-contraint" class="level2">
<h2 class="anchored" data-anchor-id="test-de-fischer-contraint">Test de Fischer contraint</h2>
<p>Pour tester la significativité d’une variable quadratique, on peut utiliser le test de Student classique sur la variable en niveau puis celle au carré. Cependant comme ces variables sont fortement corrélées, il est courant que ces variables ne soient pas individuellement significative. Pour tester la significativité, on peut utiliser le test de Fischer contraint avec l’hypothèse nulle que les coefficients associés à l’expérience et l’expérience au carrée sont égaux à 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">linearHypothesis</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  reg4,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"exper = 0"</span>, <span class="st">"I(exper^2) = 0"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Linear hypothesis test:
exper = 0
I(exper^2) = 0

Model 1: restricted model
Model 2: log(wage) ~ educ + exper + I(exper^2) + tenure

  Res.Df     RSS Df Sum of Sq      F         Pr(&gt;F)    
1    523 102.567                                       
2    521  95.011  2    7.5561 20.717 0.000000002201 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">linearHypothesis</span>(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  reg4,</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"exper = 0"</span>, <span class="st">"I(exper^2) = 0"</span>),</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">vcov. =</span> hccm</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Linear hypothesis test:
exper = 0
I(exper^2) = 0

Model 1: restricted model
Model 2: log(wage) ~ educ + exper + I(exper^2) + tenure

Note: Coefficient covariance matrix supplied.

  Res.Df Df    F          Pr(&gt;F)    
1    523                            
2    521  2 22.6 0.0000000003869 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>On peut voir que l’on peut rejeter l’hypothèse nulle de non significativité avec le test normal et le test robuste à l’hétéroscédasticité. Prise ensemble les variables de l’expérience et son terme au carré ont un effet significatif.</p>
</section>
<section id="ajout-dune-variable-binaire" class="level2">
<h2 class="anchored" data-anchor-id="ajout-dune-variable-binaire">Ajout d’une variable binaire</h2>
<p>Il est commun de vouloir prendre en compte certaines caractéristiques des individus étudiés par le biais de variables binaires. On peut supposer par exemple que la relation liant le salaire à l’éducation est la même entre les hommes et les femmes à l’exception près que les hommes auront de manière systématique un salaire plus élevé que celui des femmes.</p>
<p>Pour tester cela on va introduire une variable binaire <em>female</em> qui va prendre la valeur 1 si l’individu est une femme.</p>
<p><span class="math display">\[
log(wage_i) = \alpha + \beta_1 \text{educ}_i + \beta_2 \text{exper}_i + \beta_3 \text{exper}_i^2 + \beta_4 \text{tenure}_i + \delta_1\text{female}_i + u_i
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>reg5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> tenure <span class="sc">+</span> female, <span class="at">data =</span> wage1)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>(reg5_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg5))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(wage) ~ educ + exper + I(exper^2) + tenure + 
    female, data = wage1)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.83192 -0.26206 -0.01504  0.23972  1.14937 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)  0.4146366  0.0994195   4.171  0.00003559829083431 ***
educ         0.0809586  0.0067841  11.934 &lt; 0.0000000000000002 ***
exper        0.0328100  0.0048111   6.820  0.00000000002542656 ***
I(exper^2)  -0.0006480  0.0001046  -6.197  0.00000000116931519 ***
tenure       0.0162150  0.0028808   5.629  0.00000002974313522 ***
female      -0.2979067  0.0359802  -8.280  0.00000000000000105 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4018 on 520 degrees of freedom
Multiple R-squared:  0.4341,    Adjusted R-squared:  0.4286 
F-statistic: 79.77 on 5 and 520 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Une femme (female = 1) aura en moyenne toute chose égale par ailleurs (à caractéristiques égales à celle d’un homme) un salaire inférieur de 29% par rapport à un homme.</p>
<p>On peut également penser qu’il existe un écart permanent entre les individus catégorisés “blanc” et les autres. Pour cela, on intègre la variable <em>nonwhite</em> qui prend la valeur 1 si l’individu n’est pas blanc.</p>
<p><span class="math display">\[
log(wage_i) = \alpha + \beta_1 \text{educ}_i + \beta_2 \text{exper}_i + \beta_3 \text{exper}_i^2 + \beta_4 \text{tenure}_i + \delta_1\text{female}_i + \delta_2 \text{nonwhite}_i + u_i
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>reg6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> tenure <span class="sc">+</span> female <span class="sc">+</span> nonwhite, <span class="at">data =</span> wage1)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>(reg6_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg6))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(wage) ~ educ + exper + I(exper^2) + tenure + 
    female + nonwhite, data = wage1)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.83436 -0.26015 -0.01746  0.23702  1.14824 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)  0.4202759  0.1004005   4.186  0.00003334911554995 ***
educ         0.0807012  0.0068171  11.838 &lt; 0.0000000000000002 ***
exper        0.0328548  0.0048161   6.822  0.00000000002511277 ***
I(exper^2)  -0.0006493  0.0001047  -6.202  0.00000000113854243 ***
tenure       0.0162263  0.0028832   5.628  0.00000002989768939 ***
female      -0.2981506  0.0360134  -8.279  0.00000000000000106 ***
nonwhite    -0.0243631  0.0580159  -0.420                0.675    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4021 on 519 degrees of freedom
Multiple R-squared:  0.4343,    Adjusted R-squared:  0.4277 
F-statistic:  66.4 on 6 and 519 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Il semblerait qu’il n’y ait pas de différence systématique entre les personnes blanches et les autres puisque la p.value du test de Student est largement supérieure à 5%.</p>
</section>
<section id="terme-dinteraction" class="level2">
<h2 class="anchored" data-anchor-id="terme-dinteraction">Terme d’interaction</h2>
<p>Il existe un écart permanent entre le salaire des hommes et des femmes toutes choses égales par ailleurs. Mais on peut supposer que la différence entre les homme et les femmes se fait également sur le rendement de l’éducation. On peut penser qu’il existe des inégalités telles qu’une année d’éducation pour une femme est moins bien valorisée qu’une année d’éducation pour un homme. Pour tester cela on va intégrer une variable d’interaction entre la variable <em>educ</em> et la variable <em>female</em>.</p>
<p><span class="math display">\[
log(wage_i) = \alpha + \beta_1 \text{educ}_i + \beta_2 \text{exper}_i + \beta_3 \text{exper}_i^2 + \beta_4 \text{tenure}_i + \delta_1\text{female}_i + \delta_2 \text{educ}_i.\text{female}_i + u_i
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>reg7 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> tenure <span class="sc">+</span> female <span class="sc">+</span> educ<span class="sc">*</span>female, <span class="at">data =</span> wage1)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Similaire à </span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># reg7 &lt;- lm(log(wage) ~ exper + I(exper^2) + educ*female, data = wage1)</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>(reg7_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg7))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(wage) ~ educ + exper + I(exper^2) + tenure + 
    female + educ * female, data = wage1)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.8327 -0.2557 -0.0175  0.2447  1.1631 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)  0.3945828  0.1192685   3.308                0.001 ** 
educ         0.0825245  0.0085128   9.694 &lt; 0.0000000000000002 ***
exper        0.0327610  0.0048180   6.800      0.0000000000289 ***
I(exper^2)  -0.0006468  0.0001047  -6.175      0.0000000013380 ***
tenure       0.0162552  0.0028864   5.632      0.0000000292617 ***
female      -0.2478035  0.1681813  -1.473                0.141    
educ:female -0.0039994  0.0131133  -0.305                0.760    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4021 on 519 degrees of freedom
Multiple R-squared:  0.4342,    Adjusted R-squared:  0.4276 
F-statistic: 66.37 on 6 and 519 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>On remarque qu’il existe toujours toutes choses égales par ailleurs une différence moyenne de 24.7% de salaire entre les hommes et les femmes. Cependant ce coefficient n’est plus significatif. La variable d’interaction n’est quand à elle pas du tout significative individuellement. On remarque tout de même, qu’une année d’éducation supplémentaire pour une femme se traduit en moyenne par un rendement de l’éducation plus faible de 0.3% (même si on ne peut pas dire que ce résultat soit significativement de 0).</p>
<p>On peut interpréter ce type de modélisation comme le fait d’avoir un modèle pour les hommes (lorsque <em>female</em> égal 0) et un modèle pour les femmes (lorsque <em>female</em> égal 1). On peut donc tester si le modèle pour les hommes est le même modèle que pour les femmes en tester la significativité conjointe de la variable <em>female</em> avec le terme d’interaction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">linearHypothesis</span>(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  reg7,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"female = 0"</span>, <span class="st">"educ:female = 0"</span>)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Linear hypothesis test:
female = 0
educ:female = 0

Model 1: restricted model
Model 2: log(wage) ~ educ + exper + I(exper^2) + tenure + female + educ * 
    female

  Res.Df    RSS Df Sum of Sq      F              Pr(&gt;F)    
1    521 95.011                                            
2    519 83.929  2    11.082 34.264 0.00000000000001055 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Prises conjointement les deux variables sont significatives au seuil de 5% et même en-dessous. Il semble donc que le modèle entre les hommes et les femmes diffère. La difficulté est de savoir s’il diffère uniquement au niveau de la constante (donc simplement un écart persistant) ou bien s’il diffère aussi au niveau de la relation. Au vu du faible niveau de significativité de la variable d’interaction et du fait que le R² ajusté diminue avec l’inclusion de cette variable, il semble que la différence se fasse uniquement au niveau de la constante.</p>
</section>
<section id="ajout-dune-variable-qualitative-à-plusieurs-modalités" class="level2">
<h2 class="anchored" data-anchor-id="ajout-dune-variable-qualitative-à-plusieurs-modalités">Ajout d’une variable qualitative à plusieurs modalités</h2>
<p>Il est possible d’inclure dans le modèle une variable qualitative à plusieurs niveaux. La base de données <em>wage1</em> comprend les variables <em>northcen</em>, <em>south</em> et <em>west</em> qui indiquent si un individu vit dans la région nord-centrales des US, vit dans la région sud ou dans la région ouest. Il s’agit de trois variables binaires que l’on peut intégrer dans le modèle et que l’on interprétera par rapport aux habitants de la région est (donné par la valeur de la constante).</p>
<p><span class="math display">\[
log(wage_i) = \alpha + \beta_1 \text{educ}_i + \beta_2 \text{exper}_i + \beta_3 \text{exper}_i^2 + \beta_4 \text{tenure}_i + \delta_1\text{female}_i + \delta_2 \text{northcen} + \delta_3 \text{south} + \delta_4 \text{west} + u_i
\]</span></p>
<p>Cependant, les variables qualitatives seront assez rarement pré-traitées comme ceci. il est plus courant d’avoir une variable contenant différentes chaînes de caractères indiquant les différentes modalités. Nous allons recréer une telle variable afin de montrer que cela s’utilise très facilement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>wage1_modif <span class="ot">&lt;-</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  wage1 <span class="sc">|&gt;</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Créer une variable région qui indique la région dans laquelle vit l'individu</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> </span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>        northcen <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"north-central"</span>,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>        south <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"south"</span>,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>        west <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"west"</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">.default =</span> <span class="st">"east"</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mise sous type "factor". Pas obligatoire mais utile</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Peut aussi utiliser la fonction : factor de base de R</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> forcats<span class="sc">::</span><span class="fu">fct</span>(region, <span class="at">levels =</span> <span class="fu">unique</span>(region))</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(wage, region, educ, exper, tenure, female)</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wage1_modif)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  wage region educ exper tenure female
1 3.10   west   11     2      0      1
2 3.24   west   12    22      2      1
3 3.00   west   11     2      0      0
4 6.00   west    8    44     28      0
5 5.30   west   12     7      2      0
6 8.75   west   16     9      8      0</code></pre>
</div>
</div>
<p>La variable région est désormais une variable de type “facteur” qui est le type utilisé pour les variables catégorielles. Il n’est pas obligé pour une régression de transformer la variable en type facteur mais cela a quelques avantages comme permettre d’éviter les typographies si on spécifie les différentes catégories possibles ou encore d’ordonner les catégories.</p>
<p>Dans la fonction <code>forcats::fct()</code> si l’argument <code>levels</code> n’est pas indiqué, alors la liste des catégories possibles sera définie comme étant l’ensemble unique des éléments dans la variable (ce qui ici ne change rien). La fonction <code>levels</code> permet d’obtenir les différentes catégories de la variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(wage1_modif<span class="sc">$</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "west"          "east"          "south"         "north-central"</code></pre>
</div>
</div>
<p>La variable de référence qui sera utilisée dans la régression correspond au premier niveau affiché. Ici ce sera <em>west</em>. Pour pouvoir comparer le résultat avec les variables dummy il faudrait que la variable de référence soit <em>east</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir l'ordre voulu pour les régions</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>region_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"east"</span>, <span class="st">"west"</span>, <span class="st">"south"</span>, <span class="st">"north-central"</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>wage1_modif <span class="ot">&lt;-</span> </span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  wage1_modif <span class="sc">|&gt;</span> </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># On indique que "east" est la modalité de référence</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">relevel</span>(region, <span class="st">"east"</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(wage1_modif<span class="sc">$</span>region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "east"          "west"          "south"         "north-central"</code></pre>
</div>
</div>
<p>Il n’est pas nécessaire pour l’estimation de créer les variables binaire. On peut directement donner la variable catégorielle.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>reg8 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> tenure <span class="sc">+</span> female <span class="sc">+</span> region, </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> wage1_modif</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>(reg8_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg8))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(wage) ~ educ + exper + I(exper^2) + tenure + 
    female + region, data = wage1_modif)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.92320 -0.24657 -0.01521  0.24396  1.18278 

Coefficients:
                      Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)          0.4669302  0.1047449   4.458      0.0000101623059 ***
educ                 0.0795662  0.0067954  11.709 &lt; 0.0000000000000002 ***
exper                0.0336184  0.0048290   6.962      0.0000000000102 ***
I(exper^2)          -0.0006615  0.0001049  -6.307      0.0000000006129 ***
tenure               0.0158252  0.0028709   5.512      0.0000000559773 ***
female              -0.3048205  0.0358330  -8.507 &lt; 0.0000000000000002 ***
regionwest           0.0606929  0.0562190   1.080               0.2808    
regionsouth         -0.0914848  0.0475479  -1.924               0.0549 .  
regionnorth-central -0.0582118  0.0506611  -1.149               0.2511    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3991 on 517 degrees of freedom
Multiple R-squared:  0.4449,    Adjusted R-squared:  0.4363 
F-statistic: 51.79 on 8 and 517 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Ce qui donne le même résultat que :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> tenure <span class="sc">+</span> female <span class="sc">+</span> northcen <span class="sc">+</span> south <span class="sc">+</span> west, </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> wage1</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(wage) ~ educ + exper + I(exper^2) + tenure + 
    female + northcen + south + west, data = wage1)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.92320 -0.24657 -0.01521  0.24396  1.18278 

Coefficients:
              Estimate Std. Error t value             Pr(&gt;|t|)    
(Intercept)  0.4669302  0.1047449   4.458      0.0000101623059 ***
educ         0.0795662  0.0067954  11.709 &lt; 0.0000000000000002 ***
exper        0.0336184  0.0048290   6.962      0.0000000000102 ***
I(exper^2)  -0.0006615  0.0001049  -6.307      0.0000000006129 ***
tenure       0.0158252  0.0028709   5.512      0.0000000559773 ***
female      -0.3048205  0.0358330  -8.507 &lt; 0.0000000000000002 ***
northcen    -0.0582118  0.0506611  -1.149               0.2511    
south       -0.0914848  0.0475479  -1.924               0.0549 .  
west         0.0606929  0.0562190   1.080               0.2808    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3991 on 517 degrees of freedom
Multiple R-squared:  0.4449,    Adjusted R-squared:  0.4363 
F-statistic: 51.79 on 8 and 517 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
<p>Seule la modalité <em>south</em> est statistiquement significative au seuil de 10%. Cela signifie que les individus vivant dans le sud des Etats-Unis ont en moyenne un salaire horaire inférieur de 9.1% toutes choses égales par ailleurs comparé aux individus vivant dans l’est des Etats-Unis. En revanche les individus vivant dans le nord ou l’ouest n’ont pas statistiquement un salaire horaire différent des individus vivant dans l’est.</p>
<p>Encore une fois, il peut être judicieux de tester si l’inclusion de toutes ces modalités a conjointement un effet significatif.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">linearHypothesis</span>(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  reg8, </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"regionnorth-central = 0"</span>, <span class="st">"regionwest = 0"</span>, <span class="st">"regionsouth = 0"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Linear hypothesis test:
regionnorth-central = 0
regionwest = 0
regionsouth = 0

Model 1: restricted model
Model 2: log(wage) ~ educ + exper + I(exper^2) + tenure + female + region

  Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
1    520 83.944                              
2    517 82.339  3    1.6056 3.3604 0.01862 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Toutes les modalités de lieux de vie sont conjointement significatives au seuil de 5%.</p>
</section>
<section id="multicolinéarité" class="level2">
<h2 class="anchored" data-anchor-id="multicolinéarité">Multicolinéarité</h2>
<p>Une des conditions pour que le modèle soit identifiable est la non-colinéarité parfaite entre des variables du modèle. Il ne faut pas qu’une variable puisse être parfaitement expliquée par une combinaison linéaire d’autres variables. Le cas le plus classique se trouve lors de l’inclusion de variables qualitatives. Il faut dans ce cas retirer une modalité (ou la constante) qui deviendra la modalité de référence.</p>
<p>La multicolinéarité est un problème différent. On parle de multicolinéarité lorsque des variables sont fortement liées entre elles. Si des variables explicatives sont très fortement corrélées entre elles cela fait augmenter l’erreur-standard des estimateurs. En effet, les estimateurs étant des coefficients de corrélation partiels purgés des effets des autres variables, si des variables sont trop corrélées les unes aux autres cela brouille la précision de l’estimation.</p>
<p>On peut tester cela en regardant les facteurs d’inflation de la variance (VIF). Le VIF mesure à quel point la variance d’un paramètre augmente à cause de l’inclusion des autres variables. Pour tester la colinéarité des variables on peut utiliser la fonction <code>check_colinearity()</code> ou bien la fonction <code>vif</code> pour récupérer un tableau de résultat.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_collinearity</span>(reg8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

   Term  VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI
   educ 1.17 [ 1.09,  1.33]     1.08      0.86     [0.75, 0.92]
 tenure 1.42 [ 1.29,  1.60]     1.19      0.71     [0.62, 0.78]
 female 1.06 [ 1.01,  1.29]     1.03      0.94     [0.78, 0.99]
 region 1.05 [ 1.01,  1.33]     1.01      0.95     [0.75, 0.99]

High Correlation

       Term   VIF     VIF 95% CI adj. VIF Tolerance Tolerance 95% CI
      exper 14.16 [12.06, 16.65]     3.76      0.07     [0.06, 0.08]
 I(exper^2) 13.77 [11.73, 16.19]     3.71      0.07     [0.06, 0.09]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(reg8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                GVIF Df GVIF^(1/(2*Df))
educ        1.167169  1        1.080356
exper      14.159610  1        3.762926
I(exper^2) 13.766198  1        3.710283
tenure      1.418023  1        1.190808
female      1.058321  1        1.028747
region      1.047749  3        1.007804</code></pre>
</div>
</div>
<p>On peut interpréter le coefficient VIF de la façon suivante : l’erreur standard du coefficient d’éducation serait <span class="math inline">\(\sqrt{1.16} = 1.077\)</span> fois plus élevée que l’erreur standard de ce même coefficient si aucune variable n’était incluse. Cela nous montre que l’erreur standard de l’expérience est <span class="math inline">\(\sqrt{14.15} \approx 3.76\)</span> fois plus élevée que si aucune autre variable n’était incluse. Cela tient au fait que l’expérience est très fortement corrélée avec l’expérience au carré.</p>
<p>généralement, on dira qu’un VIF supérieur 5 indique une colinéarité moyenne tandis qu’un VIF supérieur à 10 indique une colinéarité élevée. Dans ces cas là, plusieurs solutions sont possibles. Ou bien On supprime une des variables avec un VIF élevé pour voir si la colinéarité a disparu (ici on pourrait supprimer l’expérience au carré) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure <span class="sc">+</span> female <span class="sc">+</span> region, <span class="at">data =</span> wage1_modif</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  performance<span class="sc">::</span><span class="fu">check_collinearity</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Check for Multicollinearity

Low Correlation

   Term  VIF   VIF 95% CI adj. VIF Tolerance Tolerance 95% CI
   educ 1.13 [1.06, 1.30]     1.06      0.88     [0.77, 0.94]
  exper 1.49 [1.35, 1.68]     1.22      0.67     [0.59, 0.74]
 tenure 1.41 [1.28, 1.60]     1.19      0.71     [0.63, 0.78]
 female 1.06 [1.01, 1.29]     1.03      0.94     [0.78, 0.99]
 region 1.03 [1.00, 1.70]     1.00      0.97     [0.59, 1.00]</code></pre>
</div>
</div>
<p>Seulement parfois on ne peut/veut pas supprimer une variable de noter modèle puisque l’on estime que cette variable est importante. On estime par exemple que l’expérience a une relation quadratique qui est indispensable à prendre en compte. Dans ce cas on peut utiliser les tests de Fischer pour tester si conjointement les variables colinéaires ont un impact significatif sur le modèle.</p>
</section>
<section id="prédiction-1" class="level2">
<h2 class="anchored" data-anchor-id="prédiction-1">Prédiction</h2>
<p>On souhaite prédire le salaire qu’aurait un homme “moyen” habitant dans l’est dans l’échantillon. Pour cela on va créer un dataframe qui contiendra les valeurs moyennes des prédicteurs puis on utilisera la fonction <code>predict</code> pour obtenir notre prédiction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>df_indiv_moyen <span class="ot">&lt;-</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  wage1_modif <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(educ, exper, tenure),</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">mean</span>(.x)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">female =</span> <span class="dv">0</span>,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"east"</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(reg8, df_indiv_moyen)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
1.927795 </code></pre>
</div>
</div>
<p>On peut voir qu’un homme “moyen” habitant dans l’est aurait un salaire en log prédit de <span class="math inline">\(1.93\)</span> environ, soit un salaire horaire prédit de <span class="math inline">\(exp(1.93) \approx 6.87\)</span> dollars.</p>
<p>On peut aussi faire de multiples prédictions d’un coup. Par exemple on peut regarder le salaire prédit des individus caractéristiques à différents quantiles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>df_indiv_quantile <span class="ot">&lt;-</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">educ =</span> <span class="fu">quantile</span>(wage1<span class="sc">$</span>educ, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)),</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">exper =</span> <span class="fu">quantile</span>(wage1<span class="sc">$</span>exper, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>)),</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">tenure =</span> <span class="fu">quantile</span>(wage1<span class="sc">$</span>tenure, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="at">by =</span> <span class="fl">0.1</span>))</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a><span class="co"># PAsser directement à l'exponentielle pour avoir une interprétation en salaire horaire</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">predict</span>(reg4, df_indiv_quantile))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
2.799808 3.518482 4.137702 4.507997 4.890760 5.741605 6.710100 7.605957 
       9 
8.767651 </code></pre>
</div>
</div>
</section>
<section id="tables-de-régression" class="level2">
<h2 class="anchored" data-anchor-id="tables-de-régression">Tables de régression</h2>
<p>Savoir présenter ses résultats est (presque) aussi important que d’obtenir les résultats. Il est évidemment hors de question de réécrire manuellement les résultats dans un tableau World ou une table LaTeX. De librairies telles que <code>stargazer</code> ou <code>modelsummary</code> existent afin de permettre de créer les tables voulues sous divers formats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>list_exported_models <span class="ot">&lt;-</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    reg2, reg3, reg4, reg5</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  list_exported_models, </span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_map =</span> <span class="fu">c</span>(<span class="st">"nobs"</span>, <span class="st">"adj.r.squared"</span>, <span class="st">"aic"</span>)</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script src="https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.js"></script>

    <script>
      // Create table-specific functions using external factory
      const tableFns_fmscy9gwhigp2n2y0grq = TinyTable.createTableFunctions("tinytable_fmscy9gwhigp2n2y0grq");
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: '15', j: 2 }, { i: '15', j: 3 }, { i: '15', j: 4 }, { i: '15', j: 5 } ], css_id: 'tinytable_css_e9df2otvebqipty3oj0q',}, 
          { positions: [ { i: '12', j: 2 }, { i: '12', j: 3 }, { i: '12', j: 4 }, { i: '12', j: 5 } ], css_id: 'tinytable_css_a348ehalp64cgpd1w7k9',}, 
          { positions: [ { i: '1', j: 2 }, { i: '2', j: 2 }, { i: '3', j: 2 }, { i: '4', j: 2 }, { i: '5', j: 2 }, { i: '6', j: 2 }, { i: '7', j: 2 }, { i: '8', j: 2 }, { i: '9', j: 2 }, { i: '10', j: 2 }, { i: '11', j: 2 }, { i: '13', j: 2 }, { i: '14', j: 2 }, { i: '1', j: 3 }, { i: '2', j: 3 }, { i: '3', j: 3 }, { i: '4', j: 3 }, { i: '5', j: 3 }, { i: '6', j: 3 }, { i: '7', j: 3 }, { i: '8', j: 3 }, { i: '9', j: 3 }, { i: '10', j: 3 }, { i: '11', j: 3 }, { i: '13', j: 3 }, { i: '14', j: 3 }, { i: '1', j: 4 }, { i: '2', j: 4 }, { i: '3', j: 4 }, { i: '4', j: 4 }, { i: '5', j: 4 }, { i: '6', j: 4 }, { i: '7', j: 4 }, { i: '8', j: 4 }, { i: '9', j: 4 }, { i: '10', j: 4 }, { i: '11', j: 4 }, { i: '13', j: 4 }, { i: '14', j: 4 }, { i: '1', j: 5 }, { i: '2', j: 5 }, { i: '3', j: 5 }, { i: '4', j: 5 }, { i: '5', j: 5 }, { i: '6', j: 5 }, { i: '7', j: 5 }, { i: '8', j: 5 }, { i: '9', j: 5 }, { i: '10', j: 5 }, { i: '11', j: 5 }, { i: '13', j: 5 }, { i: '14', j: 5 } ], css_id: 'tinytable_css_rmz9rgj0xba0epewyxl9',}, 
          { positions: [ { i: '0', j: 2 }, { i: '0', j: 3 }, { i: '0', j: 4 }, { i: '0', j: 5 } ], css_id: 'tinytable_css_9o0die50pev3t7lfr8kz',}, 
          { positions: [ { i: '15', j: 1 } ], css_id: 'tinytable_css_hclq9n28oqze4sy1s19i',}, 
          { positions: [ { i: '12', j: 1 } ], css_id: 'tinytable_css_7wt6kp82smkv3hg4l189',}, 
          { positions: [ { i: '1', j: 1 }, { i: '2', j: 1 }, { i: '3', j: 1 }, { i: '4', j: 1 }, { i: '5', j: 1 }, { i: '6', j: 1 }, { i: '7', j: 1 }, { i: '8', j: 1 }, { i: '9', j: 1 }, { i: '10', j: 1 }, { i: '11', j: 1 }, { i: '13', j: 1 }, { i: '14', j: 1 } ], css_id: 'tinytable_css_zv9wt0xdl9rznr18wxbk',}, 
          { positions: [ { i: '0', j: 1 } ], css_id: 'tinytable_css_pj6bqgy3tvh4ksymcuil',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  tableFns_fmscy9gwhigp2n2y0grq.styleCell(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/vincentarelbundock/tinytable@main/inst/tinytable.css">
    <style>
    /* tinytable css entries after */
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_e9df2otvebqipty3oj0q, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_e9df2otvebqipty3oj0q {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_a348ehalp64cgpd1w7k9, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_a348ehalp64cgpd1w7k9 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_rmz9rgj0xba0epewyxl9, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_rmz9rgj0xba0epewyxl9 { text-align: center }
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_9o0die50pev3t7lfr8kz, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_9o0die50pev3t7lfr8kz {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: center }
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_hclq9n28oqze4sy1s19i, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_hclq9n28oqze4sy1s19i {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.1em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_7wt6kp82smkv3hg4l189, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_7wt6kp82smkv3hg4l189 {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 0; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_zv9wt0xdl9rznr18wxbk, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_zv9wt0xdl9rznr18wxbk { text-align: left }
    #tinytable_fmscy9gwhigp2n2y0grq td.tinytable_css_pj6bqgy3tvh4ksymcuil, #tinytable_fmscy9gwhigp2n2y0grq th.tinytable_css_pj6bqgy3tvh4ksymcuil {  position: relative; --border-bottom: 1; --border-left: 0; --border-right: 0; --border-top: 1; --line-color-bottom: var(--tt-line-color); --line-color-left: var(--tt-line-color); --line-color-right: var(--tt-line-color); --line-color-top: var(--tt-line-color); --line-width-bottom: 0.05em; --line-width-left: 0.1em; --line-width-right: 0.1em; --line-width-top: 0.1em; --trim-bottom-left: 0%; --trim-bottom-right: 0%; --trim-left-bottom: 0%; --trim-left-top: 0%; --trim-right-bottom: 0%; --trim-right-top: 0%; --trim-top-left: 0%; --trim-top-right: 0%; ; text-align: left }
    </style>
    <div class="container">
      <table class="tinytable" id="tinytable_fmscy9gwhigp2n2y0grq" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        
        <thead>
              <tr>
                <th scope="col" data-row="0" data-col="1"> </th>
                <th scope="col" data-row="0" data-col="2">(1)</th>
                <th scope="col" data-row="0" data-col="3">(2)</th>
                <th scope="col" data-row="0" data-col="4">(3)</th>
                <th scope="col" data-row="0" data-col="5">(4)</th>
              </tr>
        </thead>
        <tfoot><tr><td colspan="5">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td></tr></tfoot>
        <tbody>
                <tr>
                  <td data-row="1" data-col="1">(Intercept)</td>
                  <td data-row="1" data-col="2">0.584***</td>
                  <td data-row="1" data-col="3">0.284**</td>
                  <td data-row="1" data-col="4">0.198+</td>
                  <td data-row="1" data-col="5">0.415***</td>
                </tr>
                <tr>
                  <td data-row="2" data-col="1"></td>
                  <td data-row="2" data-col="2">(0.097)</td>
                  <td data-row="2" data-col="3">(0.104)</td>
                  <td data-row="2" data-col="4">(0.102)</td>
                  <td data-row="2" data-col="5">(0.099)</td>
                </tr>
                <tr>
                  <td data-row="3" data-col="1">educ</td>
                  <td data-row="3" data-col="2">0.083***</td>
                  <td data-row="3" data-col="3">0.092***</td>
                  <td data-row="3" data-col="4">0.085***</td>
                  <td data-row="3" data-col="5">0.081***</td>
                </tr>
                <tr>
                  <td data-row="4" data-col="1"></td>
                  <td data-row="4" data-col="2">(0.008)</td>
                  <td data-row="4" data-col="3">(0.007)</td>
                  <td data-row="4" data-col="4">(0.007)</td>
                  <td data-row="4" data-col="5">(0.007)</td>
                </tr>
                <tr>
                  <td data-row="5" data-col="1">exper</td>
                  <td data-row="5" data-col="2"></td>
                  <td data-row="5" data-col="3">0.004*</td>
                  <td data-row="5" data-col="4">0.033***</td>
                  <td data-row="5" data-col="5">0.033***</td>
                </tr>
                <tr>
                  <td data-row="6" data-col="1"></td>
                  <td data-row="6" data-col="2"></td>
                  <td data-row="6" data-col="3">(0.002)</td>
                  <td data-row="6" data-col="4">(0.005)</td>
                  <td data-row="6" data-col="5">(0.005)</td>
                </tr>
                <tr>
                  <td data-row="7" data-col="1">tenure</td>
                  <td data-row="7" data-col="2"></td>
                  <td data-row="7" data-col="3">0.022***</td>
                  <td data-row="7" data-col="4">0.021***</td>
                  <td data-row="7" data-col="5">0.016***</td>
                </tr>
                <tr>
                  <td data-row="8" data-col="1"></td>
                  <td data-row="8" data-col="2"></td>
                  <td data-row="8" data-col="3">(0.003)</td>
                  <td data-row="8" data-col="4">(0.003)</td>
                  <td data-row="8" data-col="5">(0.003)</td>
                </tr>
                <tr>
                  <td data-row="9" data-col="1">I(exper^2)</td>
                  <td data-row="9" data-col="2"></td>
                  <td data-row="9" data-col="3"></td>
                  <td data-row="9" data-col="4">-0.001***</td>
                  <td data-row="9" data-col="5">-0.001***</td>
                </tr>
                <tr>
                  <td data-row="10" data-col="1"></td>
                  <td data-row="10" data-col="2"></td>
                  <td data-row="10" data-col="3"></td>
                  <td data-row="10" data-col="4">(0.000)</td>
                  <td data-row="10" data-col="5">(0.000)</td>
                </tr>
                <tr>
                  <td data-row="11" data-col="1">female</td>
                  <td data-row="11" data-col="2"></td>
                  <td data-row="11" data-col="3"></td>
                  <td data-row="11" data-col="4"></td>
                  <td data-row="11" data-col="5">-0.298***</td>
                </tr>
                <tr>
                  <td data-row="12" data-col="1"></td>
                  <td data-row="12" data-col="2"></td>
                  <td data-row="12" data-col="3"></td>
                  <td data-row="12" data-col="4"></td>
                  <td data-row="12" data-col="5">(0.036)</td>
                </tr>
                <tr>
                  <td data-row="13" data-col="1">Num.Obs.</td>
                  <td data-row="13" data-col="2">526</td>
                  <td data-row="13" data-col="3">526</td>
                  <td data-row="13" data-col="4">526</td>
                  <td data-row="13" data-col="5">526</td>
                </tr>
                <tr>
                  <td data-row="14" data-col="1">R2 Adj.</td>
                  <td data-row="14" data-col="2">0.184</td>
                  <td data-row="14" data-col="3">0.312</td>
                  <td data-row="14" data-col="4">0.355</td>
                  <td data-row="14" data-col="5">0.429</td>
                </tr>
                <tr>
                  <td data-row="15" data-col="1">AIC</td>
                  <td data-row="15" data-col="2">2432.4</td>
                  <td data-row="15" data-col="3">2344.8</td>
                  <td data-row="15" data-col="4">2312.3</td>
                  <td data-row="15" data-col="5">2249.1</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>